{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\nimport { useNewMessageNotification } from './hooks/useNewMessageNotification';\nimport { usePrependedMessagesCount } from './hooks/usePrependMessagesCount';\nimport { useShouldForceScrollToBottom } from './hooks/useShouldForceScrollToBottom';\nimport { MessageNotification as DefaultMessageNotification } from './MessageNotification';\nimport { processMessages } from './utils';\nimport { DateSeparator as DefaultDateSeparator } from '../DateSeparator/DateSeparator';\nimport { EmptyStateIndicator as DefaultEmptyStateIndicator } from '../EmptyStateIndicator/EmptyStateIndicator';\nimport { EventComponent } from '../EventComponent/EventComponent';\nimport { LoadingIndicator as DefaultLoadingIndicator } from '../Loading/LoadingIndicator';\nimport { FixedHeightMessage } from '../Message/FixedHeightMessage';\nimport { Message } from '../Message/Message';\nimport { useChannelActionContext } from '../../context/ChannelActionContext';\nimport { useChannelStateContext } from '../../context/ChannelStateContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { useComponentContext } from '../../context/ComponentContext';\nimport { isDate, useTranslationContext } from '../../context/TranslationContext';\nvar PREPEND_OFFSET = Math.pow(10, 7);\n\nvar VirtualizedMessageListWithContext = function (props) {\n  var channel = props.channel,\n      client = props.client,\n      customMessageRenderer = props.customMessageRenderer,\n      _a = props.disableDateSeparator,\n      disableDateSeparator = _a === void 0 ? true : _a,\n      hasMore = props.hasMore,\n      _b = props.hideDeletedMessages,\n      hideDeletedMessages = _b === void 0 ? false : _b,\n      _c = props.hideNewMessageSeparator,\n      hideNewMessageSeparator = _c === void 0 ? false : _c,\n      loadingMore = props.loadingMore,\n      loadMore = props.loadMore,\n      propMessage = props.Message,\n      _d = props.messageLimit,\n      messageLimit = _d === void 0 ? 100 : _d,\n      messages = props.messages,\n      _e = props.overscan,\n      overscan = _e === void 0 ? 0 : _e,\n      // TODO: refactor to scrollSeekPlaceHolderConfiguration and components.ScrollSeekPlaceholder, like the Virtuoso Component\n  scrollSeekPlaceHolder = props.scrollSeekPlaceHolder,\n      _f = props.scrollToLatestMessageOnFocus,\n      scrollToLatestMessageOnFocus = _f === void 0 ? false : _f,\n      _g = props.shouldGroupByUser,\n      shouldGroupByUser = _g === void 0 ? false : _g,\n      _h = props.stickToBottomScrollBehavior,\n      stickToBottomScrollBehavior = _h === void 0 ? 'smooth' : _h;\n\n  var _j = useComponentContext(),\n      _k = _j.DateSeparator,\n      DateSeparator = _k === void 0 ? DefaultDateSeparator : _k,\n      _l = _j.EmptyStateIndicator,\n      EmptyStateIndicator = _l === void 0 ? DefaultEmptyStateIndicator : _l,\n      _m = _j.LoadingIndicator,\n      LoadingIndicator = _m === void 0 ? DefaultLoadingIndicator : _m,\n      _o = _j.MessageNotification,\n      MessageNotification = _o === void 0 ? DefaultMessageNotification : _o,\n      _p = _j.MessageSystem,\n      MessageSystem = _p === void 0 ? EventComponent : _p,\n      _q = _j.TypingIndicator,\n      TypingIndicator = _q === void 0 ? null : _q,\n      _r = _j.VirtualMessage,\n      contextMessage = _r === void 0 ? FixedHeightMessage : _r;\n\n  var t = useTranslationContext().t;\n  var lastRead = useMemo(function () {\n    var _a;\n\n    return (_a = channel.lastRead) === null || _a === void 0 ? void 0 : _a.call(channel);\n  }, [channel]);\n  var MessageUIComponent = propMessage || contextMessage;\n  var processedMessages = useMemo(function () {\n    if (typeof messages === 'undefined') {\n      return [];\n    }\n\n    if (disableDateSeparator && !hideDeletedMessages && hideNewMessageSeparator) {\n      return messages;\n    }\n\n    return processMessages(messages, lastRead, client.userID, hideDeletedMessages, disableDateSeparator, hideNewMessageSeparator);\n  }, [disableDateSeparator, hideDeletedMessages, hideNewMessageSeparator, lastRead, messages, messages === null || messages === void 0 ? void 0 : messages.length, client.userID]);\n  var virtuoso = useRef(null);\n\n  var _s = useNewMessageNotification(processedMessages, client.userID),\n      atBottom = _s.atBottom,\n      newMessagesNotification = _s.newMessagesNotification,\n      setNewMessagesNotification = _s.setNewMessagesNotification;\n\n  var scrollToBottom = useCallback(function () {\n    if (virtuoso.current) {\n      virtuoso.current.scrollToIndex(processedMessages.length - 1);\n    }\n\n    setNewMessagesNotification(false);\n  }, [virtuoso, processedMessages, setNewMessagesNotification, processedMessages.length]);\n  var scrollToBottomIfConfigured = useCallback(function (event) {\n    if (scrollToLatestMessageOnFocus && event.target === window) {\n      setTimeout(scrollToBottom, 100);\n    }\n  }, [scrollToLatestMessageOnFocus, scrollToBottom]);\n  useEffect(function () {\n    if (typeof window !== 'undefined') {\n      window.addEventListener('focus', scrollToBottomIfConfigured);\n    }\n\n    return function () {\n      return window.removeEventListener('focus', scrollToBottomIfConfigured);\n    };\n  }, [scrollToBottomIfConfigured]);\n  var numItemsPrepended = usePrependedMessagesCount(processedMessages);\n  var shouldForceScrollToBottom = useShouldForceScrollToBottom(processedMessages, client.userID);\n  var messageRenderer = useCallback(function (messageList, virtuosoIndex) {\n    var streamMessageIndex = virtuosoIndex + numItemsPrepended - PREPEND_OFFSET; // use custom renderer supplied by client if present and skip the rest\n\n    if (customMessageRenderer) {\n      return customMessageRenderer(messageList, streamMessageIndex);\n    }\n\n    var message = messageList[streamMessageIndex];\n\n    if (message.customType === 'message.date' && message.date && isDate(message.date)) {\n      return React.createElement(DateSeparator, {\n        date: message.date,\n        unread: message.unread\n      });\n    }\n\n    if (!message) return React.createElement(\"div\", {\n      style: {\n        height: '1px'\n      }\n    }); // returning null or zero height breaks the virtuoso\n\n    if (message.type === 'system') {\n      return React.createElement(MessageSystem, {\n        message: message\n      });\n    }\n\n    return React.createElement(Message, {\n      message: message,\n      Message: function () {\n        var _a, _b;\n\n        return React.createElement(MessageUIComponent, {\n          groupedByUser: shouldGroupByUser && streamMessageIndex > 0 && ((_a = message.user) === null || _a === void 0 ? void 0 : _a.id) === ((_b = messageList[streamMessageIndex - 1].user) === null || _b === void 0 ? void 0 : _b.id)\n        });\n      }\n    });\n  }, [customMessageRenderer, shouldGroupByUser, numItemsPrepended]);\n  var virtuosoComponents = useMemo(function () {\n    var EmptyPlaceholder = function () {\n      return React.createElement(React.Fragment, null, EmptyStateIndicator && React.createElement(EmptyStateIndicator, {\n        listType: 'message'\n      }));\n    };\n\n    var Header = function () {\n      return loadingMore ? React.createElement(\"div\", {\n        className: 'str-chat__virtual-list__loading'\n      }, React.createElement(LoadingIndicator, {\n        size: 20\n      })) : React.createElement(React.Fragment, null);\n    }; // using 'display: inline-block' traps CSS margins of the item elements, preventing incorrect item measurements\n\n\n    var Item = function (props) {\n      return React.createElement(\"div\", __assign({}, props, {\n        className: 'str-chat__virtual-list-message-wrapper'\n      }));\n    };\n\n    var Footer = function () {\n      return TypingIndicator ? React.createElement(TypingIndicator, {\n        avatarSize: 24\n      }) : React.createElement(React.Fragment, null);\n    };\n\n    return {\n      EmptyPlaceholder: EmptyPlaceholder,\n      Footer: Footer,\n      Header: Header,\n      Item: Item\n    };\n  }, [loadingMore]);\n  if (!processedMessages) return null;\n  return React.createElement(\"div\", {\n    className: 'str-chat__virtual-list'\n  }, React.createElement(Virtuoso, __assign({\n    atBottomStateChange: function (isAtBottom) {\n      atBottom.current = isAtBottom;\n\n      if (isAtBottom && newMessagesNotification) {\n        setNewMessagesNotification(false);\n      }\n    },\n    components: virtuosoComponents,\n    firstItemIndex: PREPEND_OFFSET - numItemsPrepended,\n    followOutput: function (isAtBottom) {\n      if (shouldForceScrollToBottom()) {\n        return isAtBottom ? stickToBottomScrollBehavior : 'auto';\n      } // a message from another user has been received - don't scroll to bottom unless already there\n\n\n      return isAtBottom ? stickToBottomScrollBehavior : false;\n    },\n    initialTopMostItemIndex: processedMessages && processedMessages.length > 0 ? processedMessages.length - 1 : 0,\n    itemContent: function (i) {\n      return messageRenderer(processedMessages, i);\n    },\n    overscan: overscan,\n    ref: virtuoso,\n    startReached: function () {\n      if (hasMore && loadMore) {\n        loadMore(messageLimit);\n      }\n    },\n    style: {\n      overflowX: 'hidden'\n    },\n    totalCount: processedMessages.length\n  }, scrollSeekPlaceHolder ? {\n    scrollSeek: scrollSeekPlaceHolder\n  } : {})), React.createElement(\"div\", {\n    className: 'str-chat__list-notifications'\n  }, React.createElement(MessageNotification, {\n    onClick: scrollToBottom,\n    showNotification: newMessagesNotification\n  }, t('New Messages!'))));\n};\n/**\n * The VirtualizedMessageList component renders a list of messages in a virtualized list.\n * It is a consumer of the React contexts set in [Channel](https://github.com/GetStream/stream-chat-react/blob/master/src/components/Channel/Channel.tsx).\n *\n * **Note**: It works well when there are thousands of messages in a channel, it has a shortcoming though - the message UI should have a fixed height.\n */\n\n\nexport function VirtualizedMessageList(props) {\n  var loadMore = useChannelActionContext().loadMore;\n\n  var _a = useChannelStateContext(),\n      channel = _a.channel,\n      hasMore = _a.hasMore,\n      loadingMore = _a.loadingMore,\n      contextMessages = _a.messages;\n\n  var client = useChatContext().client;\n  var messages = props.messages || contextMessages;\n  return React.createElement(VirtualizedMessageListWithContext, __assign({\n    channel: channel,\n    client: client,\n    hasMore: !!hasMore,\n    loadingMore: !!loadingMore,\n    loadMore: loadMore,\n    messages: messages\n  }, props));\n}","map":{"version":3,"sources":["/Users/zeeshanpatel/flow/node_modules/stream-chat-react/dist/components/MessageList/VirtualizedMessageList.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","useCallback","useEffect","useMemo","useRef","Virtuoso","useNewMessageNotification","usePrependedMessagesCount","useShouldForceScrollToBottom","MessageNotification","DefaultMessageNotification","processMessages","DateSeparator","DefaultDateSeparator","EmptyStateIndicator","DefaultEmptyStateIndicator","EventComponent","LoadingIndicator","DefaultLoadingIndicator","FixedHeightMessage","Message","useChannelActionContext","useChannelStateContext","useChatContext","useComponentContext","isDate","useTranslationContext","PREPEND_OFFSET","Math","pow","VirtualizedMessageListWithContext","props","channel","client","customMessageRenderer","_a","disableDateSeparator","hasMore","_b","hideDeletedMessages","_c","hideNewMessageSeparator","loadingMore","loadMore","propMessage","_d","messageLimit","messages","_e","overscan","scrollSeekPlaceHolder","_f","scrollToLatestMessageOnFocus","_g","shouldGroupByUser","_h","stickToBottomScrollBehavior","_j","_k","_l","_m","_o","_p","MessageSystem","_q","TypingIndicator","_r","VirtualMessage","contextMessage","lastRead","MessageUIComponent","processedMessages","userID","virtuoso","_s","atBottom","newMessagesNotification","setNewMessagesNotification","scrollToBottom","current","scrollToIndex","scrollToBottomIfConfigured","event","target","window","setTimeout","addEventListener","removeEventListener","numItemsPrepended","shouldForceScrollToBottom","messageRenderer","messageList","virtuosoIndex","streamMessageIndex","message","customType","date","createElement","unread","style","height","type","groupedByUser","user","id","virtuosoComponents","EmptyPlaceholder","Fragment","listType","Header","className","size","Item","Footer","avatarSize","atBottomStateChange","isAtBottom","components","firstItemIndex","followOutput","initialTopMostItemIndex","itemContent","ref","startReached","overflowX","totalCount","scrollSeek","onClick","showNotification","VirtualizedMessageList","contextMessages"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { Virtuoso, } from 'react-virtuoso';\nimport { useNewMessageNotification } from './hooks/useNewMessageNotification';\nimport { usePrependedMessagesCount } from './hooks/usePrependMessagesCount';\nimport { useShouldForceScrollToBottom } from './hooks/useShouldForceScrollToBottom';\nimport { MessageNotification as DefaultMessageNotification } from './MessageNotification';\nimport { processMessages } from './utils';\nimport { DateSeparator as DefaultDateSeparator } from '../DateSeparator/DateSeparator';\nimport { EmptyStateIndicator as DefaultEmptyStateIndicator } from '../EmptyStateIndicator/EmptyStateIndicator';\nimport { EventComponent } from '../EventComponent/EventComponent';\nimport { LoadingIndicator as DefaultLoadingIndicator } from '../Loading/LoadingIndicator';\nimport { FixedHeightMessage } from '../Message/FixedHeightMessage';\nimport { Message } from '../Message/Message';\nimport { useChannelActionContext, } from '../../context/ChannelActionContext';\nimport { useChannelStateContext } from '../../context/ChannelStateContext';\nimport { useChatContext } from '../../context/ChatContext';\nimport { useComponentContext } from '../../context/ComponentContext';\nimport { isDate, useTranslationContext } from '../../context/TranslationContext';\nvar PREPEND_OFFSET = Math.pow(10, 7);\nvar VirtualizedMessageListWithContext = function (props) {\n    var channel = props.channel, client = props.client, customMessageRenderer = props.customMessageRenderer, _a = props.disableDateSeparator, disableDateSeparator = _a === void 0 ? true : _a, hasMore = props.hasMore, _b = props.hideDeletedMessages, hideDeletedMessages = _b === void 0 ? false : _b, _c = props.hideNewMessageSeparator, hideNewMessageSeparator = _c === void 0 ? false : _c, loadingMore = props.loadingMore, loadMore = props.loadMore, propMessage = props.Message, _d = props.messageLimit, messageLimit = _d === void 0 ? 100 : _d, messages = props.messages, _e = props.overscan, overscan = _e === void 0 ? 0 : _e, \n    // TODO: refactor to scrollSeekPlaceHolderConfiguration and components.ScrollSeekPlaceholder, like the Virtuoso Component\n    scrollSeekPlaceHolder = props.scrollSeekPlaceHolder, _f = props.scrollToLatestMessageOnFocus, scrollToLatestMessageOnFocus = _f === void 0 ? false : _f, _g = props.shouldGroupByUser, shouldGroupByUser = _g === void 0 ? false : _g, _h = props.stickToBottomScrollBehavior, stickToBottomScrollBehavior = _h === void 0 ? 'smooth' : _h;\n    var _j = useComponentContext(), _k = _j.DateSeparator, DateSeparator = _k === void 0 ? DefaultDateSeparator : _k, _l = _j.EmptyStateIndicator, EmptyStateIndicator = _l === void 0 ? DefaultEmptyStateIndicator : _l, _m = _j.LoadingIndicator, LoadingIndicator = _m === void 0 ? DefaultLoadingIndicator : _m, _o = _j.MessageNotification, MessageNotification = _o === void 0 ? DefaultMessageNotification : _o, _p = _j.MessageSystem, MessageSystem = _p === void 0 ? EventComponent : _p, _q = _j.TypingIndicator, TypingIndicator = _q === void 0 ? null : _q, _r = _j.VirtualMessage, contextMessage = _r === void 0 ? FixedHeightMessage : _r;\n    var t = useTranslationContext().t;\n    var lastRead = useMemo(function () { var _a; return (_a = channel.lastRead) === null || _a === void 0 ? void 0 : _a.call(channel); }, [channel]);\n    var MessageUIComponent = propMessage || contextMessage;\n    var processedMessages = useMemo(function () {\n        if (typeof messages === 'undefined') {\n            return [];\n        }\n        if (disableDateSeparator && !hideDeletedMessages && hideNewMessageSeparator) {\n            return messages;\n        }\n        return processMessages(messages, lastRead, client.userID, hideDeletedMessages, disableDateSeparator, hideNewMessageSeparator);\n    }, [\n        disableDateSeparator,\n        hideDeletedMessages,\n        hideNewMessageSeparator,\n        lastRead,\n        messages,\n        messages === null || messages === void 0 ? void 0 : messages.length,\n        client.userID,\n    ]);\n    var virtuoso = useRef(null);\n    var _s = useNewMessageNotification(processedMessages, client.userID), atBottom = _s.atBottom, newMessagesNotification = _s.newMessagesNotification, setNewMessagesNotification = _s.setNewMessagesNotification;\n    var scrollToBottom = useCallback(function () {\n        if (virtuoso.current) {\n            virtuoso.current.scrollToIndex(processedMessages.length - 1);\n        }\n        setNewMessagesNotification(false);\n    }, [virtuoso, processedMessages, setNewMessagesNotification, processedMessages.length]);\n    var scrollToBottomIfConfigured = useCallback(function (event) {\n        if (scrollToLatestMessageOnFocus && event.target === window) {\n            setTimeout(scrollToBottom, 100);\n        }\n    }, [scrollToLatestMessageOnFocus, scrollToBottom]);\n    useEffect(function () {\n        if (typeof window !== 'undefined') {\n            window.addEventListener('focus', scrollToBottomIfConfigured);\n        }\n        return function () { return window.removeEventListener('focus', scrollToBottomIfConfigured); };\n    }, [scrollToBottomIfConfigured]);\n    var numItemsPrepended = usePrependedMessagesCount(processedMessages);\n    var shouldForceScrollToBottom = useShouldForceScrollToBottom(processedMessages, client.userID);\n    var messageRenderer = useCallback(function (messageList, virtuosoIndex) {\n        var streamMessageIndex = virtuosoIndex + numItemsPrepended - PREPEND_OFFSET;\n        // use custom renderer supplied by client if present and skip the rest\n        if (customMessageRenderer) {\n            return customMessageRenderer(messageList, streamMessageIndex);\n        }\n        var message = messageList[streamMessageIndex];\n        if (message.customType === 'message.date' && message.date && isDate(message.date)) {\n            return React.createElement(DateSeparator, { date: message.date, unread: message.unread });\n        }\n        if (!message)\n            return React.createElement(\"div\", { style: { height: '1px' } }); // returning null or zero height breaks the virtuoso\n        if (message.type === 'system') {\n            return React.createElement(MessageSystem, { message: message });\n        }\n        return (React.createElement(Message, { message: message, Message: function () {\n                var _a, _b;\n                return (React.createElement(MessageUIComponent, { groupedByUser: shouldGroupByUser &&\n                        streamMessageIndex > 0 &&\n                        ((_a = message.user) === null || _a === void 0 ? void 0 : _a.id) === ((_b = messageList[streamMessageIndex - 1].user) === null || _b === void 0 ? void 0 : _b.id) }));\n            } }));\n    }, [customMessageRenderer, shouldGroupByUser, numItemsPrepended]);\n    var virtuosoComponents = useMemo(function () {\n        var EmptyPlaceholder = function () { return (React.createElement(React.Fragment, null, EmptyStateIndicator && React.createElement(EmptyStateIndicator, { listType: 'message' }))); };\n        var Header = function () {\n            return loadingMore ? (React.createElement(\"div\", { className: 'str-chat__virtual-list__loading' },\n                React.createElement(LoadingIndicator, { size: 20 }))) : (React.createElement(React.Fragment, null));\n        };\n        // using 'display: inline-block' traps CSS margins of the item elements, preventing incorrect item measurements\n        var Item = function (props) { return (React.createElement(\"div\", __assign({}, props, { className: 'str-chat__virtual-list-message-wrapper' }))); };\n        var Footer = function () {\n            return TypingIndicator ? React.createElement(TypingIndicator, { avatarSize: 24 }) : React.createElement(React.Fragment, null);\n        };\n        return {\n            EmptyPlaceholder: EmptyPlaceholder,\n            Footer: Footer,\n            Header: Header,\n            Item: Item,\n        };\n    }, [loadingMore]);\n    if (!processedMessages)\n        return null;\n    return (React.createElement(\"div\", { className: 'str-chat__virtual-list' },\n        React.createElement(Virtuoso, __assign({ atBottomStateChange: function (isAtBottom) {\n                atBottom.current = isAtBottom;\n                if (isAtBottom && newMessagesNotification) {\n                    setNewMessagesNotification(false);\n                }\n            }, components: virtuosoComponents, firstItemIndex: PREPEND_OFFSET - numItemsPrepended, followOutput: function (isAtBottom) {\n                if (shouldForceScrollToBottom()) {\n                    return isAtBottom ? stickToBottomScrollBehavior : 'auto';\n                }\n                // a message from another user has been received - don't scroll to bottom unless already there\n                return isAtBottom ? stickToBottomScrollBehavior : false;\n            }, initialTopMostItemIndex: processedMessages && processedMessages.length > 0 ? processedMessages.length - 1 : 0, itemContent: function (i) { return messageRenderer(processedMessages, i); }, overscan: overscan, ref: virtuoso, startReached: function () {\n                if (hasMore && loadMore) {\n                    loadMore(messageLimit);\n                }\n            }, style: { overflowX: 'hidden' }, totalCount: processedMessages.length }, (scrollSeekPlaceHolder ? { scrollSeek: scrollSeekPlaceHolder } : {}))),\n        React.createElement(\"div\", { className: 'str-chat__list-notifications' },\n            React.createElement(MessageNotification, { onClick: scrollToBottom, showNotification: newMessagesNotification }, t('New Messages!')))));\n};\n/**\n * The VirtualizedMessageList component renders a list of messages in a virtualized list.\n * It is a consumer of the React contexts set in [Channel](https://github.com/GetStream/stream-chat-react/blob/master/src/components/Channel/Channel.tsx).\n *\n * **Note**: It works well when there are thousands of messages in a channel, it has a shortcoming though - the message UI should have a fixed height.\n */\nexport function VirtualizedMessageList(props) {\n    var loadMore = useChannelActionContext().loadMore;\n    var _a = useChannelStateContext(), channel = _a.channel, hasMore = _a.hasMore, loadingMore = _a.loadingMore, contextMessages = _a.messages;\n    var client = useChatContext().client;\n    var messages = props.messages || contextMessages;\n    return (React.createElement(VirtualizedMessageListWithContext, __assign({ channel: channel, client: client, hasMore: !!hasMore, loadingMore: !!loadingMore, loadMore: loadMore, messages: messages }, props)));\n}\n"]},"metadata":{},"sourceType":"module"}