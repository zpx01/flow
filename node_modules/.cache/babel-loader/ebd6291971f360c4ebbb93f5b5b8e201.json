{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { useCallback, useReducer } from 'react';\nimport { useChannelStateContext } from '../../../context/ChannelStateContext';\nimport { generateRandomId } from '../../../utils';\nimport { useEmojiIndex } from './useEmojiIndex';\nimport { useAttachments } from './useAttachments';\nimport { useMessageInputText } from './useMessageInputText';\nimport { useEmojiPicker } from './useEmojiPicker';\nimport { useSubmitHandler } from './useSubmitHandler';\nimport { usePasteHandler } from './usePasteHandler';\nvar emptyFileUploads = {};\nvar emptyImageUploads = {};\n/**\n * Initializes the state. Empty if the message prop is falsy.\n */\n\nvar initState = function (message) {\n  var _a, _b, _c;\n\n  if (!message) {\n    return {\n      attachments: [],\n      emojiPickerIsOpen: false,\n      fileOrder: [],\n      fileUploads: __assign({}, emptyFileUploads),\n      imageOrder: [],\n      imageUploads: __assign({}, emptyImageUploads),\n      mentioned_users: [],\n      text: ''\n    };\n  } // if message prop is defined, get image uploads, file uploads, text, etc.\n\n\n  var imageUploads = ((_a = message.attachments) === null || _a === void 0 ? void 0 : _a.filter(function (_a) {\n    var type = _a.type;\n    return type === 'image';\n  }).reduce(function (acc, attachment) {\n    var id = generateRandomId();\n    acc[id] = {\n      file: {\n        name: attachment.fallback\n      },\n      id: id,\n      state: 'finished',\n      url: attachment.image_url\n    };\n    return acc;\n  }, {})) || {};\n  var imageOrder = Object.keys(imageUploads);\n  var fileUploads = ((_b = message.attachments) === null || _b === void 0 ? void 0 : _b.filter(function (_a) {\n    var type = _a.type;\n    return type === 'file';\n  }).reduce(function (acc, attachment) {\n    var id = generateRandomId();\n    acc[id] = {\n      file: {\n        name: attachment.title || '',\n        size: attachment.file_size,\n        type: attachment.mime_type\n      },\n      id: id,\n      state: 'finished',\n      url: attachment.asset_url\n    };\n    return acc;\n  }, {})) || {};\n  var fileOrder = Object.keys(fileUploads);\n  var attachments = ((_c = message.attachments) === null || _c === void 0 ? void 0 : _c.filter(function (_a) {\n    var type = _a.type;\n    return type !== 'file' && type !== 'image';\n  })) || [];\n  var mentioned_users = message.mentioned_users || [];\n  return {\n    attachments: attachments,\n    emojiPickerIsOpen: false,\n    fileOrder: fileOrder,\n    fileUploads: fileUploads,\n    imageOrder: imageOrder,\n    imageUploads: imageUploads,\n    mentioned_users: mentioned_users,\n    text: message.text || ''\n  };\n};\n/**\n * MessageInput state reducer\n */\n\n\nvar messageInputReducer = function (state, action) {\n  var _a, _b;\n\n  switch (action.type) {\n    case 'setEmojiPickerIsOpen':\n      return __assign(__assign({}, state), {\n        emojiPickerIsOpen: action.value\n      });\n\n    case 'setText':\n      return __assign(__assign({}, state), {\n        text: action.getNewText(state.text)\n      });\n\n    case 'clear':\n      return {\n        attachments: [],\n        emojiPickerIsOpen: false,\n        fileOrder: [],\n        fileUploads: __assign({}, emptyFileUploads),\n        imageOrder: [],\n        imageUploads: __assign({}, emptyImageUploads),\n        mentioned_users: [],\n        text: ''\n      };\n\n    case 'setImageUpload':\n      {\n        var imageAlreadyExists = state.imageUploads[action.id];\n        if (!imageAlreadyExists && !action.file) return state;\n        var imageOrder = imageAlreadyExists ? state.imageOrder : state.imageOrder.concat(action.id);\n\n        var newUploadFields = __assign({}, action);\n\n        delete newUploadFields.type;\n        return __assign(__assign({}, state), {\n          imageOrder: imageOrder,\n          imageUploads: __assign(__assign({}, state.imageUploads), (_a = {}, _a[action.id] = __assign(__assign({}, state.imageUploads[action.id]), newUploadFields), _a))\n        });\n      }\n\n    case 'setFileUpload':\n      {\n        var fileAlreadyExists = state.fileUploads[action.id];\n        if (!fileAlreadyExists && !action.file) return state;\n        var fileOrder = fileAlreadyExists ? state.fileOrder : state.fileOrder.concat(action.id);\n\n        var newUploadFields = __assign({}, action);\n\n        delete newUploadFields.type;\n        return __assign(__assign({}, state), {\n          fileOrder: fileOrder,\n          fileUploads: __assign(__assign({}, state.fileUploads), (_b = {}, _b[action.id] = __assign(__assign({}, state.fileUploads[action.id]), newUploadFields), _b))\n        });\n      }\n\n    case 'removeImageUpload':\n      {\n        if (!state.imageUploads[action.id]) return state; // cannot remove anything\n\n        var newImageUploads = __assign({}, state.imageUploads);\n\n        delete newImageUploads[action.id];\n        return __assign(__assign({}, state), {\n          imageOrder: state.imageOrder.filter(function (_id) {\n            return _id !== action.id;\n          }),\n          imageUploads: newImageUploads\n        });\n      }\n\n    case 'removeFileUpload':\n      {\n        if (!state.fileUploads[action.id]) return state; // cannot remove anything\n\n        var newFileUploads = __assign({}, state.fileUploads);\n\n        delete newFileUploads[action.id];\n        return __assign(__assign({}, state), {\n          fileOrder: state.fileOrder.filter(function (_id) {\n            return _id !== action.id;\n          }),\n          fileUploads: newFileUploads\n        });\n      }\n\n    case 'addMentionedUser':\n      return __assign(__assign({}, state), {\n        mentioned_users: state.mentioned_users.concat(action.user)\n      });\n\n    default:\n      return state;\n  }\n};\n/**\n * hook for MessageInput state\n */\n\n\nexport var useMessageInputState = function (props) {\n  var _a, _b;\n\n  var message = props.message;\n  var channel = useChannelStateContext().channel;\n\n  var _c = useReducer(messageInputReducer, message, initState),\n      state = _c[0],\n      dispatch = _c[1];\n\n  var _d = useMessageInputText(props, state, dispatch),\n      handleChange = _d.handleChange,\n      insertText = _d.insertText,\n      textareaRef = _d.textareaRef;\n\n  var _e = useEmojiPicker(state, dispatch, insertText),\n      closeEmojiPicker = _e.closeEmojiPicker,\n      emojiPickerRef = _e.emojiPickerRef,\n      handleEmojiKeyDown = _e.handleEmojiKeyDown,\n      onSelectEmoji = _e.onSelectEmoji,\n      openEmojiPicker = _e.openEmojiPicker;\n\n  var _f = useAttachments(props, state, dispatch),\n      maxFilesLeft = _f.maxFilesLeft,\n      numberOfUploads = _f.numberOfUploads,\n      removeFile = _f.removeFile,\n      removeImage = _f.removeImage,\n      uploadFile = _f.uploadFile,\n      uploadImage = _f.uploadImage,\n      uploadNewFiles = _f.uploadNewFiles;\n\n  var handleSubmit = useSubmitHandler(props, state, dispatch, numberOfUploads).handleSubmit;\n  var onPaste = usePasteHandler(uploadNewFiles, insertText).onPaste;\n  var isUploadEnabled = ((_b = (_a = channel === null || channel === void 0 ? void 0 : channel.getConfig) === null || _a === void 0 ? void 0 : _a.call(channel)) === null || _b === void 0 ? void 0 : _b.uploads) !== false;\n  var onSelectUser = useCallback(function (item) {\n    dispatch({\n      type: 'addMentionedUser',\n      user: item\n    });\n  }, []);\n  return __assign(__assign({}, state), {\n    /**\n     * TODO: fix the below at some point because this type casting is wrong\n     * and just forced to not have warnings currently with the unknown casting\n     */\n    closeEmojiPicker: closeEmojiPicker,\n    emojiIndex: useEmojiIndex(),\n    emojiPickerRef: emojiPickerRef,\n    handleChange: handleChange,\n    handleEmojiKeyDown: handleEmojiKeyDown,\n    handleSubmit: handleSubmit,\n    insertText: insertText,\n    isUploadEnabled: isUploadEnabled,\n    maxFilesLeft: maxFilesLeft,\n    numberOfUploads: numberOfUploads,\n    onPaste: onPaste,\n    onSelectEmoji: onSelectEmoji,\n    onSelectUser: onSelectUser,\n    openEmojiPicker: openEmojiPicker,\n    removeFile: removeFile,\n    removeImage: removeImage,\n    textareaRef: textareaRef,\n    uploadFile: uploadFile,\n    uploadImage: uploadImage,\n    uploadNewFiles: uploadNewFiles\n  });\n};","map":{"version":3,"sources":["/Users/zeeshanpatel/flow/node_modules/stream-chat-react/dist/components/MessageInput/hooks/useMessageInputState.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useCallback","useReducer","useChannelStateContext","generateRandomId","useEmojiIndex","useAttachments","useMessageInputText","useEmojiPicker","useSubmitHandler","usePasteHandler","emptyFileUploads","emptyImageUploads","initState","message","_a","_b","_c","attachments","emojiPickerIsOpen","fileOrder","fileUploads","imageOrder","imageUploads","mentioned_users","text","filter","type","reduce","acc","attachment","id","file","name","fallback","state","url","image_url","keys","title","size","file_size","mime_type","asset_url","messageInputReducer","action","value","getNewText","imageAlreadyExists","concat","newUploadFields","fileAlreadyExists","newImageUploads","_id","newFileUploads","user","useMessageInputState","props","channel","dispatch","_d","handleChange","insertText","textareaRef","_e","closeEmojiPicker","emojiPickerRef","handleEmojiKeyDown","onSelectEmoji","openEmojiPicker","_f","maxFilesLeft","numberOfUploads","removeFile","removeImage","uploadFile","uploadImage","uploadNewFiles","handleSubmit","onPaste","isUploadEnabled","getConfig","uploads","onSelectUser","item","emojiIndex"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { useCallback, useReducer } from 'react';\nimport { useChannelStateContext } from '../../../context/ChannelStateContext';\nimport { generateRandomId } from '../../../utils';\nimport { useEmojiIndex } from './useEmojiIndex';\nimport { useAttachments } from './useAttachments';\nimport { useMessageInputText } from './useMessageInputText';\nimport { useEmojiPicker } from './useEmojiPicker';\nimport { useSubmitHandler } from './useSubmitHandler';\nimport { usePasteHandler } from './usePasteHandler';\nvar emptyFileUploads = {};\nvar emptyImageUploads = {};\n/**\n * Initializes the state. Empty if the message prop is falsy.\n */\nvar initState = function (message) {\n    var _a, _b, _c;\n    if (!message) {\n        return {\n            attachments: [],\n            emojiPickerIsOpen: false,\n            fileOrder: [],\n            fileUploads: __assign({}, emptyFileUploads),\n            imageOrder: [],\n            imageUploads: __assign({}, emptyImageUploads),\n            mentioned_users: [],\n            text: '',\n        };\n    }\n    // if message prop is defined, get image uploads, file uploads, text, etc.\n    var imageUploads = ((_a = message.attachments) === null || _a === void 0 ? void 0 : _a.filter(function (_a) {\n        var type = _a.type;\n        return type === 'image';\n    }).reduce(function (acc, attachment) {\n        var id = generateRandomId();\n        acc[id] = {\n            file: {\n                name: attachment.fallback,\n            },\n            id: id,\n            state: 'finished',\n            url: attachment.image_url,\n        };\n        return acc;\n    }, {})) || {};\n    var imageOrder = Object.keys(imageUploads);\n    var fileUploads = ((_b = message.attachments) === null || _b === void 0 ? void 0 : _b.filter(function (_a) {\n        var type = _a.type;\n        return type === 'file';\n    }).reduce(function (acc, attachment) {\n        var id = generateRandomId();\n        acc[id] = {\n            file: {\n                name: attachment.title || '',\n                size: attachment.file_size,\n                type: attachment.mime_type,\n            },\n            id: id,\n            state: 'finished',\n            url: attachment.asset_url,\n        };\n        return acc;\n    }, {})) || {};\n    var fileOrder = Object.keys(fileUploads);\n    var attachments = ((_c = message.attachments) === null || _c === void 0 ? void 0 : _c.filter(function (_a) {\n        var type = _a.type;\n        return type !== 'file' && type !== 'image';\n    })) || [];\n    var mentioned_users = message.mentioned_users || [];\n    return {\n        attachments: attachments,\n        emojiPickerIsOpen: false,\n        fileOrder: fileOrder,\n        fileUploads: fileUploads,\n        imageOrder: imageOrder,\n        imageUploads: imageUploads,\n        mentioned_users: mentioned_users,\n        text: message.text || '',\n    };\n};\n/**\n * MessageInput state reducer\n */\nvar messageInputReducer = function (state, action) {\n    var _a, _b;\n    switch (action.type) {\n        case 'setEmojiPickerIsOpen':\n            return __assign(__assign({}, state), { emojiPickerIsOpen: action.value });\n        case 'setText':\n            return __assign(__assign({}, state), { text: action.getNewText(state.text) });\n        case 'clear':\n            return {\n                attachments: [],\n                emojiPickerIsOpen: false,\n                fileOrder: [],\n                fileUploads: __assign({}, emptyFileUploads),\n                imageOrder: [],\n                imageUploads: __assign({}, emptyImageUploads),\n                mentioned_users: [],\n                text: '',\n            };\n        case 'setImageUpload': {\n            var imageAlreadyExists = state.imageUploads[action.id];\n            if (!imageAlreadyExists && !action.file)\n                return state;\n            var imageOrder = imageAlreadyExists ? state.imageOrder : state.imageOrder.concat(action.id);\n            var newUploadFields = __assign({}, action);\n            delete newUploadFields.type;\n            return __assign(__assign({}, state), { imageOrder: imageOrder, imageUploads: __assign(__assign({}, state.imageUploads), (_a = {}, _a[action.id] = __assign(__assign({}, state.imageUploads[action.id]), newUploadFields), _a)) });\n        }\n        case 'setFileUpload': {\n            var fileAlreadyExists = state.fileUploads[action.id];\n            if (!fileAlreadyExists && !action.file)\n                return state;\n            var fileOrder = fileAlreadyExists ? state.fileOrder : state.fileOrder.concat(action.id);\n            var newUploadFields = __assign({}, action);\n            delete newUploadFields.type;\n            return __assign(__assign({}, state), { fileOrder: fileOrder, fileUploads: __assign(__assign({}, state.fileUploads), (_b = {}, _b[action.id] = __assign(__assign({}, state.fileUploads[action.id]), newUploadFields), _b)) });\n        }\n        case 'removeImageUpload': {\n            if (!state.imageUploads[action.id])\n                return state; // cannot remove anything\n            var newImageUploads = __assign({}, state.imageUploads);\n            delete newImageUploads[action.id];\n            return __assign(__assign({}, state), { imageOrder: state.imageOrder.filter(function (_id) { return _id !== action.id; }), imageUploads: newImageUploads });\n        }\n        case 'removeFileUpload': {\n            if (!state.fileUploads[action.id])\n                return state; // cannot remove anything\n            var newFileUploads = __assign({}, state.fileUploads);\n            delete newFileUploads[action.id];\n            return __assign(__assign({}, state), { fileOrder: state.fileOrder.filter(function (_id) { return _id !== action.id; }), fileUploads: newFileUploads });\n        }\n        case 'addMentionedUser':\n            return __assign(__assign({}, state), { mentioned_users: state.mentioned_users.concat(action.user) });\n        default:\n            return state;\n    }\n};\n/**\n * hook for MessageInput state\n */\nexport var useMessageInputState = function (props) {\n    var _a, _b;\n    var message = props.message;\n    var channel = useChannelStateContext().channel;\n    var _c = useReducer(messageInputReducer, message, initState), state = _c[0], dispatch = _c[1];\n    var _d = useMessageInputText(props, state, dispatch), handleChange = _d.handleChange, insertText = _d.insertText, textareaRef = _d.textareaRef;\n    var _e = useEmojiPicker(state, dispatch, insertText), closeEmojiPicker = _e.closeEmojiPicker, emojiPickerRef = _e.emojiPickerRef, handleEmojiKeyDown = _e.handleEmojiKeyDown, onSelectEmoji = _e.onSelectEmoji, openEmojiPicker = _e.openEmojiPicker;\n    var _f = useAttachments(props, state, dispatch), maxFilesLeft = _f.maxFilesLeft, numberOfUploads = _f.numberOfUploads, removeFile = _f.removeFile, removeImage = _f.removeImage, uploadFile = _f.uploadFile, uploadImage = _f.uploadImage, uploadNewFiles = _f.uploadNewFiles;\n    var handleSubmit = useSubmitHandler(props, state, dispatch, numberOfUploads).handleSubmit;\n    var onPaste = usePasteHandler(uploadNewFiles, insertText).onPaste;\n    var isUploadEnabled = ((_b = (_a = channel === null || channel === void 0 ? void 0 : channel.getConfig) === null || _a === void 0 ? void 0 : _a.call(channel)) === null || _b === void 0 ? void 0 : _b.uploads) !== false;\n    var onSelectUser = useCallback(function (item) {\n        dispatch({ type: 'addMentionedUser', user: item });\n    }, []);\n    return __assign(__assign({}, state), { \n        /**\n         * TODO: fix the below at some point because this type casting is wrong\n         * and just forced to not have warnings currently with the unknown casting\n         */\n        closeEmojiPicker: closeEmojiPicker, emojiIndex: useEmojiIndex(), emojiPickerRef: emojiPickerRef,\n        handleChange: handleChange,\n        handleEmojiKeyDown: handleEmojiKeyDown,\n        handleSubmit: handleSubmit,\n        insertText: insertText,\n        isUploadEnabled: isUploadEnabled,\n        maxFilesLeft: maxFilesLeft,\n        numberOfUploads: numberOfUploads,\n        onPaste: onPaste,\n        onSelectEmoji: onSelectEmoji,\n        onSelectUser: onSelectUser,\n        openEmojiPicker: openEmojiPicker,\n        removeFile: removeFile,\n        removeImage: removeImage,\n        textareaRef: textareaRef,\n        uploadFile: uploadFile,\n        uploadImage: uploadImage,\n        uploadNewFiles: uploadNewFiles });\n};\n"]},"metadata":{},"sourceType":"module"}