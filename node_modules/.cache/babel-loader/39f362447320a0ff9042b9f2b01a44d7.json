{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Textarea from 'react-textarea-autosize';\nimport getCaretCoordinates from 'textarea-caret';\nimport CustomEvent from 'custom-event';\nimport { isValidElementType } from 'react-is';\nimport Listeners, { KEY_CODES } from './listener';\nimport { List as DefaultSuggestionList } from './List';\nimport { DEFAULT_CARET_POSITION, defaultScrollToItem, errorMessage, triggerPropsCheck } from './utils';\n\nvar ReactTextareaAutocomplete =\n/** @class */\nfunction (_super) {\n  __extends(ReactTextareaAutocomplete, _super);\n\n  function ReactTextareaAutocomplete(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.getSelectionPosition = function () {\n      if (!_this.textareaRef) return null;\n      return {\n        selectionEnd: _this.textareaRef.selectionEnd,\n        selectionStart: _this.textareaRef.selectionStart\n      };\n    };\n\n    _this.getSelectedText = function () {\n      if (!_this.textareaRef) return null;\n      var _a = _this.textareaRef,\n          selectionEnd = _a.selectionEnd,\n          selectionStart = _a.selectionStart;\n      if (selectionStart === selectionEnd) return null;\n      return _this.state.value.substr(selectionStart, selectionEnd - selectionStart);\n    };\n\n    _this.setCaretPosition = function (position) {\n      if (position === void 0) {\n        position = 0;\n      }\n\n      if (!_this.textareaRef) return;\n\n      _this.textareaRef.focus();\n\n      _this.textareaRef.setSelectionRange(position, position);\n    };\n\n    _this.getCaretPosition = function () {\n      if (!_this.textareaRef) return 0;\n      return _this.textareaRef.selectionEnd;\n    };\n\n    _this.addKeycodeSubmitListeners = function (keyCodes) {\n      keyCodes.forEach(function (arrayOfCodes) {\n        var submitValue = arrayOfCodes;\n\n        if (submitValue.length === 1) {\n          submitValue = submitValue[0];\n        } // does submitted keycodes include shift+Enter?\n\n\n        var shiftE = arrayOfCodes.every(function (code) {\n          return [16, 13].includes(code);\n        });\n        if (shiftE) _this.keycodeSubmitShiftE = true;\n        return Listeners.add(submitValue, function (e) {\n          return _this._onEnter(e);\n        });\n      });\n    };\n\n    _this._onEnter = function (event) {\n      if (!_this.textareaRef) return;\n      var trigger = _this.state.currentTrigger;\n\n      var hasFocus = _this.textareaRef.matches(':focus'); // Don't submit if the element doesn't have focus or the shift key is pressed, unless shift+Enter were provided as submit keys\n\n\n      if (!hasFocus || event.shiftKey === true && !_this.keycodeSubmitShiftE || event.shiftKey === true && !_this.props.keycodeSubmitKeys) {\n        return;\n      }\n\n      if (!trigger || !_this.state.data) {\n        // trigger a submit\n        _this._replaceWord();\n\n        if (_this.textareaRef) {\n          _this.textareaRef.selectionEnd = 0;\n        }\n\n        _this.props.handleSubmit(event);\n\n        _this._closeAutocomplete();\n      }\n    };\n\n    _this._onSpace = function () {\n      if (!_this.props.replaceWord || !_this.textareaRef) return; // don't change characters if the element doesn't have focus\n\n      var hasFocus = _this.textareaRef.matches(':focus');\n\n      if (!hasFocus) return;\n\n      _this._replaceWord();\n    };\n\n    _this._replaceWord = function () {\n      var value = _this.state.value;\n      var lastWordRegex = /([^\\s]+)(\\s*)$/;\n      var match = lastWordRegex.exec(value.slice(0, _this.getCaretPosition()));\n      var lastWord = match && match[1];\n      if (!lastWord) return;\n      var spaces = match[2];\n\n      var newWord = _this.props.replaceWord(lastWord);\n\n      if (newWord == null) return;\n      var textBeforeWord = value.slice(0, _this.getCaretPosition() - match[0].length);\n      var textAfterCaret = value.slice(_this.getCaretPosition(), -1);\n      var newText = textBeforeWord + newWord + spaces + textAfterCaret;\n\n      _this.setState({\n        value: newText\n      }, function () {\n        // fire onChange event after successful selection\n        var e = new CustomEvent('change', {\n          bubbles: true\n        });\n\n        _this.textareaRef.dispatchEvent(e);\n\n        if (_this.props.onChange) _this.props.onChange(e);\n      });\n    };\n\n    _this._onSelect = function (newToken) {\n      var onChange = _this.props.onChange;\n      var _a = _this.state,\n          currentTrigger = _a.currentTrigger,\n          selectionEnd = _a.selectionEnd,\n          textareaValue = _a.value;\n      if (!currentTrigger) return;\n\n      var computeCaretPosition = function (position, token, startToken) {\n        switch (position) {\n          case 'start':\n            return startToken;\n\n          case 'next':\n          case 'end':\n            return startToken + token.length;\n\n          default:\n            if (!Number.isInteger(position)) {\n              throw new Error('RTA: caretPosition should be \"start\", \"next\", \"end\" or number.');\n            }\n\n            return position;\n        }\n      };\n\n      var textToModify = textareaValue.slice(0, selectionEnd);\n      var startOfTokenPosition = textToModify.lastIndexOf(currentTrigger); // we add space after emoji is selected if a caret position is next\n\n      var newTokenString = newToken.caretPosition === 'next' ? newToken.text + \" \" : newToken.text;\n      var newCaretPosition = computeCaretPosition(newToken.caretPosition, newTokenString, startOfTokenPosition);\n      var modifiedText = textToModify.substring(0, startOfTokenPosition) + newTokenString; // set the new textarea value and after that set the caret back to its position\n\n      _this.setState({\n        dataLoading: false,\n        value: textareaValue.replace(textToModify, modifiedText)\n      }, function () {\n        // fire onChange event after successful selection\n        var e = new CustomEvent('change', {\n          bubbles: true\n        });\n\n        _this.textareaRef.dispatchEvent(e);\n\n        if (onChange) onChange(e);\n\n        _this.setCaretPosition(newCaretPosition);\n      });\n\n      _this._closeAutocomplete();\n    };\n\n    _this._getItemOnSelect = function () {\n      var currentTrigger = _this.state.currentTrigger;\n\n      var triggerSettings = _this._getCurrentTriggerSettings();\n\n      if (!currentTrigger || !triggerSettings) return null;\n      var callback = triggerSettings.callback;\n      if (!callback) return null;\n      return function (item) {\n        if (typeof callback !== 'function') {\n          throw new Error('Output functor is not defined! You have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n        }\n\n        if (callback) {\n          return callback(item, currentTrigger);\n        }\n\n        return null;\n      };\n    };\n\n    _this._getTextToReplace = function () {\n      var _a = _this.state,\n          actualToken = _a.actualToken,\n          currentTrigger = _a.currentTrigger;\n\n      var triggerSettings = _this._getCurrentTriggerSettings();\n\n      if (!currentTrigger || !triggerSettings) return null;\n      var output = triggerSettings.output;\n      return function (item) {\n        if (typeof item === 'object' && (!output || typeof output !== 'function')) {\n          throw new Error('Output functor is not defined! If you are using items as object you have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n        }\n\n        if (output) {\n          var textToReplace = output(item, currentTrigger);\n\n          if (!textToReplace || typeof textToReplace === 'number') {\n            throw new Error(\"Output functor should return string or object in shape {text: string, caretPosition: string | number}.\\nGot \\\"\" + String(textToReplace) + \"\\\". Check the implementation for trigger \\\"\" + currentTrigger + \"\\\" and its token \\\"\" + actualToken + \"\\\"\\n\\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more informations.\\n\");\n          }\n\n          if (typeof textToReplace === 'string') {\n            return {\n              caretPosition: DEFAULT_CARET_POSITION,\n              text: textToReplace\n            };\n          }\n\n          if (!textToReplace.text) {\n            throw new Error(\"Output \\\"text\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\" + currentTrigger + \"\\\" and its token \\\"\" + actualToken + \"\\\"\\n\");\n          }\n\n          if (!textToReplace.caretPosition) {\n            throw new Error(\"Output \\\"caretPosition\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\" + currentTrigger + \"\\\" and its token \\\"\" + actualToken + \"\\\"\\n\");\n          }\n\n          return textToReplace;\n        }\n\n        if (typeof item !== 'string') {\n          throw new Error('Output item should be string\\n');\n        }\n\n        return {\n          caretPosition: DEFAULT_CARET_POSITION,\n          text: \"\" + currentTrigger + item + currentTrigger\n        };\n      };\n    };\n\n    _this._getCurrentTriggerSettings = function () {\n      var currentTrigger = _this.state.currentTrigger;\n      if (!currentTrigger) return null;\n      return _this.props.trigger[currentTrigger];\n    };\n\n    _this._getValuesFromProvider = function () {\n      var _a = _this.state,\n          actualToken = _a.actualToken,\n          currentTrigger = _a.currentTrigger;\n\n      var triggerSettings = _this._getCurrentTriggerSettings();\n\n      if (!currentTrigger || !triggerSettings) return;\n      var component = triggerSettings.component,\n          dataProvider = triggerSettings.dataProvider;\n\n      if (typeof dataProvider !== 'function') {\n        throw new Error('Trigger provider has to be a function!');\n      }\n\n      _this.setState({\n        dataLoading: true\n      }); // Modified: send the full text to support / style commands\n\n\n      dataProvider(actualToken, _this.state.value, function (data, token) {\n        // Make sure that the result is still relevant for current query\n        if (token !== _this.state.actualToken) return;\n\n        if (!Array.isArray(data)) {\n          throw new Error('Trigger provider has to provide an array!');\n        }\n\n        if (!isValidElementType(component)) {\n          throw new Error('Component should be defined!');\n        } // throw away if we resolved old trigger\n\n\n        if (currentTrigger !== _this.state.currentTrigger) return; // if we haven't resolved any data let's close the autocomplete\n\n        if (!data.length) {\n          _this._closeAutocomplete();\n\n          return;\n        }\n\n        _this.setState({\n          component: component,\n          data: data,\n          dataLoading: false\n        });\n      });\n    };\n\n    _this._getSuggestions = function () {\n      var _a = _this.state,\n          currentTrigger = _a.currentTrigger,\n          data = _a.data;\n      if (!currentTrigger || !data || data && !data.length) return null;\n      return data;\n    };\n\n    _this._createRegExp = function () {\n      var trigger = _this.props.trigger; // negative lookahead to match only the trigger + the actual token = \"bladhwd:adawd:word test\" => \":word\"\n      // https://stackoverflow.com/a/8057827/2719917\n\n      _this.tokenRegExp = new RegExp(\"([\" + Object.keys(trigger).join('') + \"])(?:(?!\\\\1)[^\\\\s])*$\");\n    };\n    /**\n     * Close autocomplete, also clean up trigger (to avoid slow promises)\n     */\n\n\n    _this._closeAutocomplete = function () {\n      _this.setState({\n        currentTrigger: null,\n        data: null,\n        dataLoading: false,\n        left: null,\n        top: null\n      });\n    };\n\n    _this._cleanUpProps = function () {\n      var props = __assign({}, _this.props);\n\n      var notSafe = ['additionalTextareaProps', 'className', 'closeOnClickOutside', 'containerClassName', 'containerStyle', 'disableMentions', 'dropdownClassName', 'dropdownStyle', 'grow', 'handleSubmit', 'innerRef', 'itemClassName', 'itemStyle', 'keycodeSubmitKeys', 'listClassName', 'listStyle', 'loaderClassName', 'loaderStyle', 'loadingComponent', 'minChar', 'movePopupAsYouType', 'onCaretPositionChange', 'onChange', 'ref', 'replaceWord', 'scrollToItem', 'SuggestionItem', 'SuggestionList', 'trigger', 'value']; // eslint-disable-next-line\n\n      for (var prop in props) {\n        if (notSafe.includes(prop)) delete props[prop];\n      }\n\n      return props;\n    };\n\n    _this._isCommand = function (text) {\n      if (text[0] !== '/') return false;\n      var tokens = text.split(' ');\n      if (tokens.length > 1) return false;\n      return true;\n    };\n\n    _this._changeHandler = function (e) {\n      var _a = _this.props,\n          minChar = _a.minChar,\n          movePopupAsYouType = _a.movePopupAsYouType,\n          onCaretPositionChange = _a.onCaretPositionChange,\n          onChange = _a.onChange,\n          trigger = _a.trigger;\n      var _b = _this.state,\n          left = _b.left,\n          top = _b.top;\n      var textarea = e.target;\n      var selectionEnd = textarea.selectionEnd,\n          selectionStart = textarea.selectionStart,\n          value = textarea.value;\n\n      if (onChange) {\n        e.persist();\n        onChange(e);\n      }\n\n      if (onCaretPositionChange) onCaretPositionChange(_this.getCaretPosition());\n\n      _this.setState({\n        value: value\n      });\n\n      var currentTrigger;\n      var lastToken;\n\n      if (_this._isCommand(value)) {\n        currentTrigger = '/';\n        lastToken = value;\n      } else {\n        var triggerTokens = Object.keys(trigger).join().replace('/', '');\n        var triggerNorWhitespace = \"[^\\\\s\" + triggerTokens + \"]*\";\n        var regex = new RegExp(\"(?!^|\\\\W)?[\" + triggerTokens + \"]\" + triggerNorWhitespace + \"\\\\s?\" + triggerNorWhitespace + \"$\", 'g');\n        var tokenMatch = value.slice(0, selectionEnd).match(regex);\n        lastToken = tokenMatch && tokenMatch[tokenMatch.length - 1].trim();\n        currentTrigger = lastToken && Object.keys(trigger).find(function (a) {\n          return a === lastToken[0];\n        }) || null;\n      }\n      /*\n       if we lost the trigger token or there is no following character we want to close\n       the autocomplete\n      */\n\n\n      if (!lastToken || lastToken.length <= minChar) {\n        _this._closeAutocomplete();\n\n        return;\n      }\n\n      var actualToken = lastToken.slice(1); // if trigger is not configured step out from the function, otherwise proceed\n\n      if (!currentTrigger) return;\n\n      if (movePopupAsYouType || top === null && left === null || // if we have single char - trigger it means we want to re-position the autocomplete\n      lastToken.length === 1) {\n        var _c = getCaretCoordinates(textarea, selectionEnd),\n            newLeft = _c.left,\n            newTop = _c.top;\n\n        _this.setState({\n          // make position relative to textarea\n          left: newLeft,\n          top: newTop - _this.textareaRef.scrollTop || 0\n        });\n      }\n\n      _this.setState({\n        actualToken: actualToken,\n        currentTrigger: currentTrigger,\n        selectionEnd: selectionEnd,\n        selectionStart: selectionStart\n      }, function () {\n        try {\n          _this._getValuesFromProvider();\n        } catch (err) {\n          errorMessage(err.message);\n        }\n      });\n    };\n\n    _this._selectHandler = function (e) {\n      var _a = _this.props,\n          onCaretPositionChange = _a.onCaretPositionChange,\n          onSelect = _a.onSelect;\n      if (onCaretPositionChange) onCaretPositionChange(_this.getCaretPosition());\n\n      if (onSelect) {\n        e.persist();\n        onSelect(e);\n      }\n    }; // The textarea itself is outside the auto-select dropdown.\n\n\n    _this._onClickAndBlurHandler = function (e) {\n      var _a = _this.props,\n          closeOnClickOutside = _a.closeOnClickOutside,\n          onBlur = _a.onBlur; // If this is a click: e.target is the textarea, and e.relatedTarget is the thing\n      // that was actually clicked. If we clicked inside the auto-select dropdown, then\n      // that's not a blur, from the auto-select point of view, so then do nothing.\n\n      var el = e.relatedTarget;\n\n      if (_this.dropdownRef && el instanceof Node && _this.dropdownRef.contains(el)) {\n        return;\n      }\n\n      if (closeOnClickOutside) _this._closeAutocomplete();\n\n      if (onBlur) {\n        e.persist();\n        onBlur(e);\n      }\n    };\n\n    _this._onScrollHandler = function () {\n      return _this._closeAutocomplete();\n    };\n\n    _this._dropdownScroll = function (item) {\n      var scrollToItem = _this.props.scrollToItem;\n      if (!scrollToItem) return;\n\n      if (scrollToItem === true) {\n        defaultScrollToItem(_this.dropdownRef, item);\n        return;\n      }\n\n      if (typeof scrollToItem !== 'function' || scrollToItem.length !== 2) {\n        throw new Error('`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.');\n      }\n\n      scrollToItem(_this.dropdownRef, item);\n    };\n\n    var _a = _this.props,\n        loadingComponent = _a.loadingComponent,\n        trigger = _a.trigger,\n        value = _a.value; // TODO: it would be better to have the parent control state...\n    // if (value) this.state.value = value;\n\n    _this._createRegExp();\n\n    if (!loadingComponent) {\n      throw new Error('RTA: loadingComponent is not defined');\n    }\n\n    if (!trigger) {\n      throw new Error('RTA: trigger is not defined');\n    }\n\n    _this.state = {\n      actualToken: '',\n      component: null,\n      currentTrigger: null,\n      data: null,\n      dataLoading: false,\n      keycodeSubmitShiftE: false,\n      left: null,\n      listenerIndex: {},\n      selectionEnd: 0,\n      selectionStart: 0,\n      top: null,\n      value: value || ''\n    };\n    return _this;\n  }\n\n  ReactTextareaAutocomplete.prototype.componentDidMount = function () {\n    var _this = this;\n\n    Listeners.add(KEY_CODES.ESC, function () {\n      return _this._closeAutocomplete();\n    });\n    Listeners.add(KEY_CODES.SPACE, function () {\n      return _this._onSpace();\n    });\n    var listenerIndex = {};\n    var newSubmitKeys = this.props.keycodeSubmitKeys;\n\n    if (newSubmitKeys) {\n      var keycodeIndex = this.addKeycodeSubmitListeners(newSubmitKeys);\n      listenerIndex[keycodeIndex] = keycodeIndex;\n    } else {\n      var enterIndex = Listeners.add(KEY_CODES.ENTER, function (e) {\n        return _this._onEnter(e);\n      });\n      listenerIndex[enterIndex] = enterIndex;\n    }\n\n    this.setState({\n      listenerIndex: listenerIndex\n    });\n    Listeners.startListen();\n  };\n\n  ReactTextareaAutocomplete.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n    this._update(nextProps);\n  };\n\n  ReactTextareaAutocomplete.prototype.componentWillUnmount = function () {\n    Listeners.stopListen();\n    Listeners.remove(this.state.listenerIndex);\n  }; // TODO: This is an anti pattern in react, should come up with a better way\n\n\n  ReactTextareaAutocomplete.prototype._update = function (_a) {\n    var trigger = _a.trigger,\n        value = _a.value;\n    var oldValue = this.state.value;\n    var oldTrigger = this.props.trigger;\n    if (value !== oldValue || !oldValue) this.setState({\n      value: value\n    });\n    /**\n     * check if trigger chars are changed, if so, change the regexp accordingly\n     */\n\n    if (Object.keys(trigger).join('') !== Object.keys(oldTrigger).join('')) {\n      this._createRegExp();\n    }\n  };\n\n  ReactTextareaAutocomplete.prototype.renderSuggestionListContainer = function () {\n    var _this = this;\n\n    var _a = this.props,\n        disableMentions = _a.disableMentions,\n        dropdownClassName = _a.dropdownClassName,\n        dropdownStyle = _a.dropdownStyle,\n        itemClassName = _a.itemClassName,\n        itemStyle = _a.itemStyle,\n        listClassName = _a.listClassName,\n        SuggestionItem = _a.SuggestionItem,\n        _b = _a.SuggestionList,\n        SuggestionList = _b === void 0 ? DefaultSuggestionList : _b;\n    var _c = this.state,\n        component = _c.component,\n        currentTrigger = _c.currentTrigger,\n        dataLoading = _c.dataLoading,\n        value = _c.value;\n\n    var selectedItem = this._getItemOnSelect();\n\n    var suggestionData = this._getSuggestions();\n\n    var textToReplace = this._getTextToReplace();\n\n    if ((dataLoading || suggestionData) && currentTrigger && !(disableMentions && currentTrigger === '@')) {\n      return React.createElement(\"div\", {\n        className: \"rta__autocomplete \" + (dropdownClassName || ''),\n        ref: function (ref) {\n          _this.dropdownRef = ref;\n        },\n        style: dropdownStyle\n      }, component && suggestionData && textToReplace && React.createElement(SuggestionList, {\n        className: listClassName,\n        component: component,\n        currentTrigger: currentTrigger,\n        dropdownScroll: this._dropdownScroll,\n        getSelectedItem: selectedItem,\n        getTextToReplace: textToReplace,\n        itemClassName: itemClassName,\n        itemStyle: itemStyle,\n        onSelect: this._onSelect,\n        selectionEnd: this.state.selectionEnd,\n        SuggestionItem: SuggestionItem,\n        value: value,\n        values: suggestionData\n      }));\n    }\n\n    return null;\n  };\n\n  ReactTextareaAutocomplete.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.props,\n        className = _a.className,\n        containerClassName = _a.containerClassName,\n        containerStyle = _a.containerStyle,\n        style = _a.style;\n    var maxRows = this.props.maxRows;\n    var _b = this.state,\n        dataLoading = _b.dataLoading,\n        value = _b.value;\n    if (!this.props.grow) maxRows = 1;\n    return React.createElement(\"div\", {\n      className: \"rta \" + (dataLoading === true ? 'rta--loading' : '') + \" \" + (containerClassName || ''),\n      style: containerStyle\n    }, this.renderSuggestionListContainer(), React.createElement(Textarea, __assign({}, this._cleanUpProps(), {\n      className: \"rta__textarea \" + (className || ''),\n      maxRows: maxRows,\n      onBlur: this._onClickAndBlurHandler,\n      onChange: this._changeHandler,\n      onClick: this._onClickAndBlurHandler,\n      onFocus: this.props.onFocus,\n      onScroll: this._onScrollHandler,\n      onSelect: this._selectHandler,\n      ref: function (ref) {\n        if (_this.props.innerRef) _this.props.innerRef(ref);\n        _this.textareaRef = ref;\n      },\n      style: style,\n      value: value\n    }, this.props.additionalTextareaProps)));\n  };\n\n  ReactTextareaAutocomplete.defaultProps = {\n    closeOnClickOutside: true,\n    maxRows: 10,\n    minChar: 1,\n    movePopupAsYouType: false,\n    scrollToItem: true,\n    value: ''\n  };\n  return ReactTextareaAutocomplete;\n}(React.Component);\n\nexport { ReactTextareaAutocomplete };\nReactTextareaAutocomplete.propTypes = {\n  className: PropTypes.string,\n  closeOnClickOutside: PropTypes.bool,\n  containerClassName: PropTypes.string,\n  containerStyle: PropTypes.object,\n  disableMentions: PropTypes.bool,\n  dropdownClassName: PropTypes.string,\n  dropdownStyle: PropTypes.object,\n  itemClassName: PropTypes.string,\n  itemStyle: PropTypes.object,\n  keycodeSubmitKeys: PropTypes.array,\n  listClassName: PropTypes.string,\n  listStyle: PropTypes.object,\n  loaderClassName: PropTypes.string,\n  loaderStyle: PropTypes.object,\n  loadingComponent: PropTypes.elementType,\n  minChar: PropTypes.number,\n  onBlur: PropTypes.func,\n  onCaretPositionChange: PropTypes.func,\n  onChange: PropTypes.func,\n  onSelect: PropTypes.func,\n  style: PropTypes.object,\n  SuggestionList: PropTypes.elementType,\n  trigger: triggerPropsCheck,\n  value: PropTypes.string\n};","map":{"version":3,"sources":["/Users/zeeshanpatel/flow/node_modules/stream-chat-react/dist/components/AutoCompleteTextarea/Textarea.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","React","PropTypes","Textarea","getCaretCoordinates","CustomEvent","isValidElementType","Listeners","KEY_CODES","List","DefaultSuggestionList","DEFAULT_CARET_POSITION","defaultScrollToItem","errorMessage","triggerPropsCheck","ReactTextareaAutocomplete","_super","props","_this","getSelectionPosition","textareaRef","selectionEnd","selectionStart","getSelectedText","_a","state","value","substr","setCaretPosition","position","focus","setSelectionRange","getCaretPosition","addKeycodeSubmitListeners","keyCodes","forEach","arrayOfCodes","submitValue","shiftE","every","code","includes","keycodeSubmitShiftE","add","e","_onEnter","event","trigger","currentTrigger","hasFocus","matches","shiftKey","keycodeSubmitKeys","data","_replaceWord","handleSubmit","_closeAutocomplete","_onSpace","replaceWord","lastWordRegex","match","exec","slice","lastWord","spaces","newWord","textBeforeWord","textAfterCaret","newText","setState","bubbles","dispatchEvent","onChange","_onSelect","newToken","textareaValue","computeCaretPosition","token","startToken","Number","isInteger","Error","textToModify","startOfTokenPosition","lastIndexOf","newTokenString","caretPosition","text","newCaretPosition","modifiedText","substring","dataLoading","replace","_getItemOnSelect","triggerSettings","_getCurrentTriggerSettings","callback","item","_getTextToReplace","actualToken","output","textToReplace","_getValuesFromProvider","component","dataProvider","isArray","_getSuggestions","_createRegExp","tokenRegExp","RegExp","keys","join","left","top","_cleanUpProps","notSafe","prop","_isCommand","tokens","split","_changeHandler","minChar","movePopupAsYouType","onCaretPositionChange","_b","textarea","target","persist","lastToken","triggerTokens","triggerNorWhitespace","regex","tokenMatch","trim","find","a","_c","newLeft","newTop","scrollTop","err","message","_selectHandler","onSelect","_onClickAndBlurHandler","closeOnClickOutside","onBlur","el","relatedTarget","dropdownRef","Node","contains","_onScrollHandler","_dropdownScroll","scrollToItem","loadingComponent","listenerIndex","componentDidMount","ESC","SPACE","newSubmitKeys","keycodeIndex","enterIndex","ENTER","startListen","UNSAFE_componentWillReceiveProps","nextProps","_update","componentWillUnmount","stopListen","remove","oldValue","oldTrigger","renderSuggestionListContainer","disableMentions","dropdownClassName","dropdownStyle","itemClassName","itemStyle","listClassName","SuggestionItem","SuggestionList","selectedItem","suggestionData","createElement","className","ref","style","dropdownScroll","getSelectedItem","getTextToReplace","values","render","containerClassName","containerStyle","maxRows","grow","onClick","onFocus","onScroll","innerRef","additionalTextareaProps","defaultProps","Component","propTypes","string","bool","object","array","listStyle","loaderClassName","loaderStyle","elementType","number","func"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Textarea from 'react-textarea-autosize';\nimport getCaretCoordinates from 'textarea-caret';\nimport CustomEvent from 'custom-event';\nimport { isValidElementType } from 'react-is';\nimport Listeners, { KEY_CODES } from './listener';\nimport { List as DefaultSuggestionList } from './List';\nimport { DEFAULT_CARET_POSITION, defaultScrollToItem, errorMessage, triggerPropsCheck, } from './utils';\nvar ReactTextareaAutocomplete = /** @class */ (function (_super) {\n    __extends(ReactTextareaAutocomplete, _super);\n    function ReactTextareaAutocomplete(props) {\n        var _this = _super.call(this, props) || this;\n        _this.getSelectionPosition = function () {\n            if (!_this.textareaRef)\n                return null;\n            return {\n                selectionEnd: _this.textareaRef.selectionEnd,\n                selectionStart: _this.textareaRef.selectionStart,\n            };\n        };\n        _this.getSelectedText = function () {\n            if (!_this.textareaRef)\n                return null;\n            var _a = _this.textareaRef, selectionEnd = _a.selectionEnd, selectionStart = _a.selectionStart;\n            if (selectionStart === selectionEnd)\n                return null;\n            return _this.state.value.substr(selectionStart, selectionEnd - selectionStart);\n        };\n        _this.setCaretPosition = function (position) {\n            if (position === void 0) { position = 0; }\n            if (!_this.textareaRef)\n                return;\n            _this.textareaRef.focus();\n            _this.textareaRef.setSelectionRange(position, position);\n        };\n        _this.getCaretPosition = function () {\n            if (!_this.textareaRef)\n                return 0;\n            return _this.textareaRef.selectionEnd;\n        };\n        _this.addKeycodeSubmitListeners = function (keyCodes) {\n            keyCodes.forEach(function (arrayOfCodes) {\n                var submitValue = arrayOfCodes;\n                if (submitValue.length === 1) {\n                    submitValue = submitValue[0];\n                }\n                // does submitted keycodes include shift+Enter?\n                var shiftE = arrayOfCodes.every(function (code) { return [16, 13].includes(code); });\n                if (shiftE)\n                    _this.keycodeSubmitShiftE = true;\n                return Listeners.add(submitValue, function (e) { return _this._onEnter(e); });\n            });\n        };\n        _this._onEnter = function (event) {\n            if (!_this.textareaRef)\n                return;\n            var trigger = _this.state.currentTrigger;\n            var hasFocus = _this.textareaRef.matches(':focus');\n            // Don't submit if the element doesn't have focus or the shift key is pressed, unless shift+Enter were provided as submit keys\n            if (!hasFocus ||\n                (event.shiftKey === true && !_this.keycodeSubmitShiftE) ||\n                (event.shiftKey === true && !_this.props.keycodeSubmitKeys)) {\n                return;\n            }\n            if (!trigger || !_this.state.data) {\n                // trigger a submit\n                _this._replaceWord();\n                if (_this.textareaRef) {\n                    _this.textareaRef.selectionEnd = 0;\n                }\n                _this.props.handleSubmit(event);\n                _this._closeAutocomplete();\n            }\n        };\n        _this._onSpace = function () {\n            if (!_this.props.replaceWord || !_this.textareaRef)\n                return;\n            // don't change characters if the element doesn't have focus\n            var hasFocus = _this.textareaRef.matches(':focus');\n            if (!hasFocus)\n                return;\n            _this._replaceWord();\n        };\n        _this._replaceWord = function () {\n            var value = _this.state.value;\n            var lastWordRegex = /([^\\s]+)(\\s*)$/;\n            var match = lastWordRegex.exec(value.slice(0, _this.getCaretPosition()));\n            var lastWord = match && match[1];\n            if (!lastWord)\n                return;\n            var spaces = match[2];\n            var newWord = _this.props.replaceWord(lastWord);\n            if (newWord == null)\n                return;\n            var textBeforeWord = value.slice(0, _this.getCaretPosition() - match[0].length);\n            var textAfterCaret = value.slice(_this.getCaretPosition(), -1);\n            var newText = textBeforeWord + newWord + spaces + textAfterCaret;\n            _this.setState({\n                value: newText,\n            }, function () {\n                // fire onChange event after successful selection\n                var e = new CustomEvent('change', { bubbles: true });\n                _this.textareaRef.dispatchEvent(e);\n                if (_this.props.onChange)\n                    _this.props.onChange(e);\n            });\n        };\n        _this._onSelect = function (newToken) {\n            var onChange = _this.props.onChange;\n            var _a = _this.state, currentTrigger = _a.currentTrigger, selectionEnd = _a.selectionEnd, textareaValue = _a.value;\n            if (!currentTrigger)\n                return;\n            var computeCaretPosition = function (position, token, startToken) {\n                switch (position) {\n                    case 'start':\n                        return startToken;\n                    case 'next':\n                    case 'end':\n                        return startToken + token.length;\n                    default:\n                        if (!Number.isInteger(position)) {\n                            throw new Error('RTA: caretPosition should be \"start\", \"next\", \"end\" or number.');\n                        }\n                        return position;\n                }\n            };\n            var textToModify = textareaValue.slice(0, selectionEnd);\n            var startOfTokenPosition = textToModify.lastIndexOf(currentTrigger);\n            // we add space after emoji is selected if a caret position is next\n            var newTokenString = newToken.caretPosition === 'next' ? newToken.text + \" \" : newToken.text;\n            var newCaretPosition = computeCaretPosition(newToken.caretPosition, newTokenString, startOfTokenPosition);\n            var modifiedText = textToModify.substring(0, startOfTokenPosition) + newTokenString;\n            // set the new textarea value and after that set the caret back to its position\n            _this.setState({\n                dataLoading: false,\n                value: textareaValue.replace(textToModify, modifiedText),\n            }, function () {\n                // fire onChange event after successful selection\n                var e = new CustomEvent('change', { bubbles: true });\n                _this.textareaRef.dispatchEvent(e);\n                if (onChange)\n                    onChange(e);\n                _this.setCaretPosition(newCaretPosition);\n            });\n            _this._closeAutocomplete();\n        };\n        _this._getItemOnSelect = function () {\n            var currentTrigger = _this.state.currentTrigger;\n            var triggerSettings = _this._getCurrentTriggerSettings();\n            if (!currentTrigger || !triggerSettings)\n                return null;\n            var callback = triggerSettings.callback;\n            if (!callback)\n                return null;\n            return function (item) {\n                if (typeof callback !== 'function') {\n                    throw new Error('Output functor is not defined! You have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n                }\n                if (callback) {\n                    return callback(item, currentTrigger);\n                }\n                return null;\n            };\n        };\n        _this._getTextToReplace = function () {\n            var _a = _this.state, actualToken = _a.actualToken, currentTrigger = _a.currentTrigger;\n            var triggerSettings = _this._getCurrentTriggerSettings();\n            if (!currentTrigger || !triggerSettings)\n                return null;\n            var output = triggerSettings.output;\n            return function (item) {\n                if (typeof item === 'object' && (!output || typeof output !== 'function')) {\n                    throw new Error('Output functor is not defined! If you are using items as object you have to define \"output\" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');\n                }\n                if (output) {\n                    var textToReplace = output(item, currentTrigger);\n                    if (!textToReplace || typeof textToReplace === 'number') {\n                        throw new Error(\"Output functor should return string or object in shape {text: string, caretPosition: string | number}.\\nGot \\\"\" + String(textToReplace) + \"\\\". Check the implementation for trigger \\\"\" + currentTrigger + \"\\\" and its token \\\"\" + actualToken + \"\\\"\\n\\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more informations.\\n\");\n                    }\n                    if (typeof textToReplace === 'string') {\n                        return {\n                            caretPosition: DEFAULT_CARET_POSITION,\n                            text: textToReplace,\n                        };\n                    }\n                    if (!textToReplace.text) {\n                        throw new Error(\"Output \\\"text\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\" + currentTrigger + \"\\\" and its token \\\"\" + actualToken + \"\\\"\\n\");\n                    }\n                    if (!textToReplace.caretPosition) {\n                        throw new Error(\"Output \\\"caretPosition\\\" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger \\\"\" + currentTrigger + \"\\\" and its token \\\"\" + actualToken + \"\\\"\\n\");\n                    }\n                    return textToReplace;\n                }\n                if (typeof item !== 'string') {\n                    throw new Error('Output item should be string\\n');\n                }\n                return {\n                    caretPosition: DEFAULT_CARET_POSITION,\n                    text: \"\" + currentTrigger + item + currentTrigger,\n                };\n            };\n        };\n        _this._getCurrentTriggerSettings = function () {\n            var currentTrigger = _this.state.currentTrigger;\n            if (!currentTrigger)\n                return null;\n            return _this.props.trigger[currentTrigger];\n        };\n        _this._getValuesFromProvider = function () {\n            var _a = _this.state, actualToken = _a.actualToken, currentTrigger = _a.currentTrigger;\n            var triggerSettings = _this._getCurrentTriggerSettings();\n            if (!currentTrigger || !triggerSettings)\n                return;\n            var component = triggerSettings.component, dataProvider = triggerSettings.dataProvider;\n            if (typeof dataProvider !== 'function') {\n                throw new Error('Trigger provider has to be a function!');\n            }\n            _this.setState({ dataLoading: true });\n            // Modified: send the full text to support / style commands\n            dataProvider(actualToken, _this.state.value, function (data, token) {\n                // Make sure that the result is still relevant for current query\n                if (token !== _this.state.actualToken)\n                    return;\n                if (!Array.isArray(data)) {\n                    throw new Error('Trigger provider has to provide an array!');\n                }\n                if (!isValidElementType(component)) {\n                    throw new Error('Component should be defined!');\n                }\n                // throw away if we resolved old trigger\n                if (currentTrigger !== _this.state.currentTrigger)\n                    return;\n                // if we haven't resolved any data let's close the autocomplete\n                if (!data.length) {\n                    _this._closeAutocomplete();\n                    return;\n                }\n                _this.setState({\n                    component: component,\n                    data: data,\n                    dataLoading: false,\n                });\n            });\n        };\n        _this._getSuggestions = function () {\n            var _a = _this.state, currentTrigger = _a.currentTrigger, data = _a.data;\n            if (!currentTrigger || !data || (data && !data.length))\n                return null;\n            return data;\n        };\n        _this._createRegExp = function () {\n            var trigger = _this.props.trigger;\n            // negative lookahead to match only the trigger + the actual token = \"bladhwd:adawd:word test\" => \":word\"\n            // https://stackoverflow.com/a/8057827/2719917\n            _this.tokenRegExp = new RegExp(\"([\" + Object.keys(trigger).join('') + \"])(?:(?!\\\\1)[^\\\\s])*$\");\n        };\n        /**\n         * Close autocomplete, also clean up trigger (to avoid slow promises)\n         */\n        _this._closeAutocomplete = function () {\n            _this.setState({\n                currentTrigger: null,\n                data: null,\n                dataLoading: false,\n                left: null,\n                top: null,\n            });\n        };\n        _this._cleanUpProps = function () {\n            var props = __assign({}, _this.props);\n            var notSafe = [\n                'additionalTextareaProps',\n                'className',\n                'closeOnClickOutside',\n                'containerClassName',\n                'containerStyle',\n                'disableMentions',\n                'dropdownClassName',\n                'dropdownStyle',\n                'grow',\n                'handleSubmit',\n                'innerRef',\n                'itemClassName',\n                'itemStyle',\n                'keycodeSubmitKeys',\n                'listClassName',\n                'listStyle',\n                'loaderClassName',\n                'loaderStyle',\n                'loadingComponent',\n                'minChar',\n                'movePopupAsYouType',\n                'onCaretPositionChange',\n                'onChange',\n                'ref',\n                'replaceWord',\n                'scrollToItem',\n                'SuggestionItem',\n                'SuggestionList',\n                'trigger',\n                'value',\n            ];\n            // eslint-disable-next-line\n            for (var prop in props) {\n                if (notSafe.includes(prop))\n                    delete props[prop];\n            }\n            return props;\n        };\n        _this._isCommand = function (text) {\n            if (text[0] !== '/')\n                return false;\n            var tokens = text.split(' ');\n            if (tokens.length > 1)\n                return false;\n            return true;\n        };\n        _this._changeHandler = function (e) {\n            var _a = _this.props, minChar = _a.minChar, movePopupAsYouType = _a.movePopupAsYouType, onCaretPositionChange = _a.onCaretPositionChange, onChange = _a.onChange, trigger = _a.trigger;\n            var _b = _this.state, left = _b.left, top = _b.top;\n            var textarea = e.target;\n            var selectionEnd = textarea.selectionEnd, selectionStart = textarea.selectionStart, value = textarea.value;\n            if (onChange) {\n                e.persist();\n                onChange(e);\n            }\n            if (onCaretPositionChange)\n                onCaretPositionChange(_this.getCaretPosition());\n            _this.setState({ value: value });\n            var currentTrigger;\n            var lastToken;\n            if (_this._isCommand(value)) {\n                currentTrigger = '/';\n                lastToken = value;\n            }\n            else {\n                var triggerTokens = Object.keys(trigger).join().replace('/', '');\n                var triggerNorWhitespace = \"[^\\\\s\" + triggerTokens + \"]*\";\n                var regex = new RegExp(\"(?!^|\\\\W)?[\" + triggerTokens + \"]\" + triggerNorWhitespace + \"\\\\s?\" + triggerNorWhitespace + \"$\", 'g');\n                var tokenMatch = value.slice(0, selectionEnd).match(regex);\n                lastToken = tokenMatch && tokenMatch[tokenMatch.length - 1].trim();\n                currentTrigger = (lastToken && Object.keys(trigger).find(function (a) { return a === lastToken[0]; })) || null;\n            }\n            /*\n             if we lost the trigger token or there is no following character we want to close\n             the autocomplete\n            */\n            if (!lastToken || lastToken.length <= minChar) {\n                _this._closeAutocomplete();\n                return;\n            }\n            var actualToken = lastToken.slice(1);\n            // if trigger is not configured step out from the function, otherwise proceed\n            if (!currentTrigger)\n                return;\n            if (movePopupAsYouType ||\n                (top === null && left === null) ||\n                // if we have single char - trigger it means we want to re-position the autocomplete\n                lastToken.length === 1) {\n                var _c = getCaretCoordinates(textarea, selectionEnd), newLeft = _c.left, newTop = _c.top;\n                _this.setState({\n                    // make position relative to textarea\n                    left: newLeft,\n                    top: newTop - _this.textareaRef.scrollTop || 0,\n                });\n            }\n            _this.setState({\n                actualToken: actualToken,\n                currentTrigger: currentTrigger,\n                selectionEnd: selectionEnd,\n                selectionStart: selectionStart,\n            }, function () {\n                try {\n                    _this._getValuesFromProvider();\n                }\n                catch (err) {\n                    errorMessage(err.message);\n                }\n            });\n        };\n        _this._selectHandler = function (e) {\n            var _a = _this.props, onCaretPositionChange = _a.onCaretPositionChange, onSelect = _a.onSelect;\n            if (onCaretPositionChange)\n                onCaretPositionChange(_this.getCaretPosition());\n            if (onSelect) {\n                e.persist();\n                onSelect(e);\n            }\n        };\n        // The textarea itself is outside the auto-select dropdown.\n        _this._onClickAndBlurHandler = function (e) {\n            var _a = _this.props, closeOnClickOutside = _a.closeOnClickOutside, onBlur = _a.onBlur;\n            // If this is a click: e.target is the textarea, and e.relatedTarget is the thing\n            // that was actually clicked. If we clicked inside the auto-select dropdown, then\n            // that's not a blur, from the auto-select point of view, so then do nothing.\n            var el = e.relatedTarget;\n            if (_this.dropdownRef && el instanceof Node && _this.dropdownRef.contains(el)) {\n                return;\n            }\n            if (closeOnClickOutside)\n                _this._closeAutocomplete();\n            if (onBlur) {\n                e.persist();\n                onBlur(e);\n            }\n        };\n        _this._onScrollHandler = function () { return _this._closeAutocomplete(); };\n        _this._dropdownScroll = function (item) {\n            var scrollToItem = _this.props.scrollToItem;\n            if (!scrollToItem)\n                return;\n            if (scrollToItem === true) {\n                defaultScrollToItem(_this.dropdownRef, item);\n                return;\n            }\n            if (typeof scrollToItem !== 'function' || scrollToItem.length !== 2) {\n                throw new Error('`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.');\n            }\n            scrollToItem(_this.dropdownRef, item);\n        };\n        var _a = _this.props, loadingComponent = _a.loadingComponent, trigger = _a.trigger, value = _a.value;\n        // TODO: it would be better to have the parent control state...\n        // if (value) this.state.value = value;\n        _this._createRegExp();\n        if (!loadingComponent) {\n            throw new Error('RTA: loadingComponent is not defined');\n        }\n        if (!trigger) {\n            throw new Error('RTA: trigger is not defined');\n        }\n        _this.state = {\n            actualToken: '',\n            component: null,\n            currentTrigger: null,\n            data: null,\n            dataLoading: false,\n            keycodeSubmitShiftE: false,\n            left: null,\n            listenerIndex: {},\n            selectionEnd: 0,\n            selectionStart: 0,\n            top: null,\n            value: value || '',\n        };\n        return _this;\n    }\n    ReactTextareaAutocomplete.prototype.componentDidMount = function () {\n        var _this = this;\n        Listeners.add(KEY_CODES.ESC, function () { return _this._closeAutocomplete(); });\n        Listeners.add(KEY_CODES.SPACE, function () { return _this._onSpace(); });\n        var listenerIndex = {};\n        var newSubmitKeys = this.props.keycodeSubmitKeys;\n        if (newSubmitKeys) {\n            var keycodeIndex = this.addKeycodeSubmitListeners(newSubmitKeys);\n            listenerIndex[keycodeIndex] = keycodeIndex;\n        }\n        else {\n            var enterIndex = Listeners.add(KEY_CODES.ENTER, function (e) { return _this._onEnter(e); });\n            listenerIndex[enterIndex] = enterIndex;\n        }\n        this.setState({\n            listenerIndex: listenerIndex,\n        });\n        Listeners.startListen();\n    };\n    ReactTextareaAutocomplete.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n        this._update(nextProps);\n    };\n    ReactTextareaAutocomplete.prototype.componentWillUnmount = function () {\n        Listeners.stopListen();\n        Listeners.remove(this.state.listenerIndex);\n    };\n    // TODO: This is an anti pattern in react, should come up with a better way\n    ReactTextareaAutocomplete.prototype._update = function (_a) {\n        var trigger = _a.trigger, value = _a.value;\n        var oldValue = this.state.value;\n        var oldTrigger = this.props.trigger;\n        if (value !== oldValue || !oldValue)\n            this.setState({ value: value });\n        /**\n         * check if trigger chars are changed, if so, change the regexp accordingly\n         */\n        if (Object.keys(trigger).join('') !== Object.keys(oldTrigger).join('')) {\n            this._createRegExp();\n        }\n    };\n    ReactTextareaAutocomplete.prototype.renderSuggestionListContainer = function () {\n        var _this = this;\n        var _a = this.props, disableMentions = _a.disableMentions, dropdownClassName = _a.dropdownClassName, dropdownStyle = _a.dropdownStyle, itemClassName = _a.itemClassName, itemStyle = _a.itemStyle, listClassName = _a.listClassName, SuggestionItem = _a.SuggestionItem, _b = _a.SuggestionList, SuggestionList = _b === void 0 ? DefaultSuggestionList : _b;\n        var _c = this.state, component = _c.component, currentTrigger = _c.currentTrigger, dataLoading = _c.dataLoading, value = _c.value;\n        var selectedItem = this._getItemOnSelect();\n        var suggestionData = this._getSuggestions();\n        var textToReplace = this._getTextToReplace();\n        if ((dataLoading || suggestionData) &&\n            currentTrigger &&\n            !(disableMentions && currentTrigger === '@')) {\n            return (React.createElement(\"div\", { className: \"rta__autocomplete \" + (dropdownClassName || ''), ref: function (ref) {\n                    _this.dropdownRef = ref;\n                }, style: dropdownStyle }, component && suggestionData && textToReplace && (React.createElement(SuggestionList, { className: listClassName, component: component, currentTrigger: currentTrigger, dropdownScroll: this._dropdownScroll, getSelectedItem: selectedItem, getTextToReplace: textToReplace, itemClassName: itemClassName, itemStyle: itemStyle, onSelect: this._onSelect, selectionEnd: this.state.selectionEnd, SuggestionItem: SuggestionItem, value: value, values: suggestionData }))));\n        }\n        return null;\n    };\n    ReactTextareaAutocomplete.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, className = _a.className, containerClassName = _a.containerClassName, containerStyle = _a.containerStyle, style = _a.style;\n        var maxRows = this.props.maxRows;\n        var _b = this.state, dataLoading = _b.dataLoading, value = _b.value;\n        if (!this.props.grow)\n            maxRows = 1;\n        return (React.createElement(\"div\", { className: \"rta \" + (dataLoading === true ? 'rta--loading' : '') + \" \" + (containerClassName || ''), style: containerStyle },\n            this.renderSuggestionListContainer(),\n            React.createElement(Textarea, __assign({}, this._cleanUpProps(), { className: \"rta__textarea \" + (className || ''), maxRows: maxRows, onBlur: this._onClickAndBlurHandler, onChange: this._changeHandler, onClick: this._onClickAndBlurHandler, onFocus: this.props.onFocus, onScroll: this._onScrollHandler, onSelect: this._selectHandler, ref: function (ref) {\n                    if (_this.props.innerRef)\n                        _this.props.innerRef(ref);\n                    _this.textareaRef = ref;\n                }, style: style, value: value }, this.props.additionalTextareaProps))));\n    };\n    ReactTextareaAutocomplete.defaultProps = {\n        closeOnClickOutside: true,\n        maxRows: 10,\n        minChar: 1,\n        movePopupAsYouType: false,\n        scrollToItem: true,\n        value: '',\n    };\n    return ReactTextareaAutocomplete;\n}(React.Component));\nexport { ReactTextareaAutocomplete };\nReactTextareaAutocomplete.propTypes = {\n    className: PropTypes.string,\n    closeOnClickOutside: PropTypes.bool,\n    containerClassName: PropTypes.string,\n    containerStyle: PropTypes.object,\n    disableMentions: PropTypes.bool,\n    dropdownClassName: PropTypes.string,\n    dropdownStyle: PropTypes.object,\n    itemClassName: PropTypes.string,\n    itemStyle: PropTypes.object,\n    keycodeSubmitKeys: PropTypes.array,\n    listClassName: PropTypes.string,\n    listStyle: PropTypes.object,\n    loaderClassName: PropTypes.string,\n    loaderStyle: PropTypes.object,\n    loadingComponent: PropTypes.elementType,\n    minChar: PropTypes.number,\n    onBlur: PropTypes.func,\n    onCaretPositionChange: PropTypes.func,\n    onChange: PropTypes.func,\n    onSelect: PropTypes.func,\n    style: PropTypes.object,\n    SuggestionList: PropTypes.elementType,\n    trigger: triggerPropsCheck,\n    value: PropTypes.string,\n};\n"]},"metadata":{},"sourceType":"module"}