{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport * as linkify from 'linkifyjs'; //@ts-expect-error\n\nimport findAndReplace from 'mdast-util-find-and-replace';\nimport RootReactMarkdown from 'react-markdown';\nimport ReactMarkdown from 'react-markdown/with-html';\nimport uniqBy from 'lodash.uniqby';\nexport var isOnlyEmojis = function (text) {\n  if (!text) return false;\n  var noEmojis = text.replace(emojiRegex(), '');\n  var noSpace = noEmojis.replace(/[\\s\\n]/gm, '');\n  return !noSpace;\n};\nvar allowedMarkups = ['html', // @ts-expect-error\n'root', 'text', 'break', 'paragraph', 'emphasis', 'strong', 'link', 'list', 'listItem', 'code', 'inlineCode', 'blockquote', 'delete'];\n\nvar matchMarkdownLinks = function (message) {\n  var regexMdLinks = /\\[([^[]+)\\](\\(.*\\))/gm;\n  var matches = message.match(regexMdLinks);\n  var singleMatch = /\\[([^[]+)\\]\\((.*)\\)/;\n  var links = matches ? matches.map(function (match) {\n    var i = singleMatch.exec(match);\n    return i && [i[1], i[2]];\n  }) : [];\n  return links.flat();\n};\n\nvar messageCodeBlocks = function (message) {\n  var codeRegex = /```[a-z]*\\n[\\s\\S]*?\\n```|`[a-z]*[\\s\\S]*?`/gm;\n  var matches = message.match(codeRegex);\n  return matches || [];\n};\n\nexport var truncate = function (input, length, end) {\n  if (end === void 0) {\n    end = '...';\n  }\n\n  if (!input || !length) return '';\n\n  if (input.length > length) {\n    return \"\" + input.substring(0, length - end.length) + end;\n  }\n\n  return input;\n};\nvar markDownRenderers = {\n  // eslint-disable-next-line react/display-name\n  link: function (props) {\n    var children = props.children,\n        href = props.href;\n    var isEmail = href === null || href === void 0 ? void 0 : href.startsWith('mailto:');\n    var isUrl = href === null || href === void 0 ? void 0 : href.startsWith('http');\n\n    if (!href || !isEmail && !isUrl) {\n      return children;\n    }\n\n    return React.createElement(\"a\", {\n      className: \"\" + (isUrl ? 'str-chat__message-url-link' : ''),\n      href: href,\n      rel: 'nofollow noreferrer noopener',\n      target: '_blank'\n    }, children);\n  },\n  span: 'span'\n};\n\nvar emojiMarkdownPlugin = function () {\n  function replace(match) {\n    return {\n      children: [{\n        type: 'text',\n        value: match\n      }],\n      className: 'inline-text-emoji',\n      type: 'span'\n    };\n  }\n\n  var transform = function (markdownAST) {\n    findAndReplace(markdownAST, emojiRegex(), replace);\n    return markdownAST;\n  };\n\n  return transform;\n};\n\nvar mentionsMarkdownPlugin = function (mentioned_users) {\n  return function () {\n    var mentioned_usernames = mentioned_users.map(function (user) {\n      return user.name || user.id;\n    }).filter(Boolean).map(escapeRegExp);\n\n    function replace(match) {\n      var usernameOrId = match.replace('@', '');\n      var user = mentioned_users.find(function (_a) {\n        var id = _a.id,\n            name = _a.name;\n        return name === usernameOrId || id === usernameOrId;\n      });\n      return {\n        children: [{\n          type: 'text',\n          value: match\n        }],\n        mentioned_user: user,\n        type: 'mention'\n      };\n    }\n\n    var transform = function (markdownAST) {\n      if (!mentioned_usernames.length) {\n        return markdownAST;\n      }\n\n      var mentionedUsersRegex = new RegExp(mentioned_usernames.map(function (username) {\n        return \"@\" + username;\n      }).join('|'), 'g');\n      findAndReplace(markdownAST, mentionedUsersRegex, replace);\n      return markdownAST;\n    };\n\n    return transform;\n  };\n};\n\nvar Mention = function (props) {\n  return React.createElement(\"span\", {\n    className: 'str-chat__message-mention'\n  }, props.children);\n};\n\nexport var renderText = function (text, mentioned_users, options) {\n  if (options === void 0) {\n    options = {};\n  } // take the @ mentions and turn them into markdown?\n  // translate links\n\n\n  if (!text) return null;\n  var newText = text;\n  var markdownLinks = matchMarkdownLinks(newText);\n  var codeBlocks = messageCodeBlocks(newText);\n  var detectHttp = /(http(s?):\\/\\/)?(www\\.)?/; // extract all valid links/emails within text and replace it with proper markup\n\n  uniqBy(linkify.find(newText), 'value').forEach(function (_a) {\n    var href = _a.href,\n        type = _a.type,\n        value = _a.value;\n    var linkIsInBlock = codeBlocks.some(function (block) {\n      return block === null || block === void 0 ? void 0 : block.includes(value);\n    }); // check if message is already  markdown\n\n    var noParsingNeeded = markdownLinks && markdownLinks.filter(function (text) {\n      var strippedHref = href === null || href === void 0 ? void 0 : href.replace(detectHttp, '');\n      var strippedText = text === null || text === void 0 ? void 0 : text.replace(detectHttp, '');\n      if (!strippedHref || !strippedText) return false;\n      return strippedHref.includes(strippedText) || strippedText.includes(strippedHref);\n    });\n    if (noParsingNeeded.length > 0 || linkIsInBlock) return;\n    var displayLink = type === 'email' ? value : value.replace(detectHttp, '');\n    newText = newText.replaceAll(value, \"[\" + displayLink + \"](\" + encodeURI(href) + \")\");\n  });\n  var plugins = [emojiMarkdownPlugin];\n\n  if (mentioned_users === null || mentioned_users === void 0 ? void 0 : mentioned_users.length) {\n    plugins.push(mentionsMarkdownPlugin(mentioned_users));\n  }\n\n  var renderers = __assign(__assign({\n    mention: Mention\n  }, markDownRenderers), options.customMarkDownRenderers);\n\n  return React.createElement(ReactMarkdown, {\n    allowedTypes: allowedMarkups,\n    escapeHtml: true,\n    plugins: plugins,\n    renderers: renderers,\n    source: newText,\n    transformLinkUri: function (uri) {\n      return uri.startsWith('app://') ? uri : RootReactMarkdown.uriTransformer(uri);\n    },\n    unwrapDisallowed: true\n  });\n};\nexport function escapeRegExp(text) {\n  return text.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n}\n\nfunction S4() {\n  return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);\n} // https://stackoverflow.com/a/6860916/2570866\n\n\nexport function generateRandomId() {\n  // prettier-ignore\n  return S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4();\n}\nexport var smartRender = function (ElementOrComponentOrLiteral, props, fallback) {\n  if (ElementOrComponentOrLiteral === undefined && fallback) {\n    ElementOrComponentOrLiteral = fallback;\n  }\n\n  if (React.isValidElement(ElementOrComponentOrLiteral)) {\n    // Flow cast through any, to make flow believe it's a React.Element\n    var element = ElementOrComponentOrLiteral;\n    return element;\n  } // Flow cast through any to remove React.Element after previous check\n\n\n  var ComponentOrLiteral = ElementOrComponentOrLiteral;\n\n  if (typeof ComponentOrLiteral === 'string' || typeof ComponentOrLiteral === 'number' || typeof ComponentOrLiteral === 'boolean' || ComponentOrLiteral == null) {\n    return ComponentOrLiteral;\n  }\n\n  return React.createElement(ComponentOrLiteral, __assign({}, props));\n};","map":{"version":3,"sources":["/Users/zeeshanpatel/flow/node_modules/stream-chat-react/dist/utils.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","emojiRegex","linkify","findAndReplace","RootReactMarkdown","ReactMarkdown","uniqBy","isOnlyEmojis","text","noEmojis","replace","noSpace","allowedMarkups","matchMarkdownLinks","message","regexMdLinks","matches","match","singleMatch","links","map","exec","flat","messageCodeBlocks","codeRegex","truncate","input","end","substring","markDownRenderers","link","props","children","href","isEmail","startsWith","isUrl","createElement","className","rel","target","span","emojiMarkdownPlugin","type","value","transform","markdownAST","mentionsMarkdownPlugin","mentioned_users","mentioned_usernames","user","name","id","filter","Boolean","escapeRegExp","usernameOrId","find","_a","mentioned_user","mentionedUsersRegex","RegExp","username","join","Mention","renderText","options","newText","markdownLinks","codeBlocks","detectHttp","forEach","linkIsInBlock","some","block","includes","noParsingNeeded","strippedHref","strippedText","displayLink","replaceAll","encodeURI","plugins","push","renderers","mention","customMarkDownRenderers","allowedTypes","escapeHtml","source","transformLinkUri","uri","uriTransformer","unwrapDisallowed","S4","Math","random","toString","generateRandomId","smartRender","ElementOrComponentOrLiteral","fallback","undefined","isValidElement","element","ComponentOrLiteral"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport * as linkify from 'linkifyjs';\n//@ts-expect-error\nimport findAndReplace from 'mdast-util-find-and-replace';\nimport RootReactMarkdown from 'react-markdown';\nimport ReactMarkdown from 'react-markdown/with-html';\nimport uniqBy from 'lodash.uniqby';\nexport var isOnlyEmojis = function (text) {\n    if (!text)\n        return false;\n    var noEmojis = text.replace(emojiRegex(), '');\n    var noSpace = noEmojis.replace(/[\\s\\n]/gm, '');\n    return !noSpace;\n};\nvar allowedMarkups = [\n    'html',\n    // @ts-expect-error\n    'root',\n    'text',\n    'break',\n    'paragraph',\n    'emphasis',\n    'strong',\n    'link',\n    'list',\n    'listItem',\n    'code',\n    'inlineCode',\n    'blockquote',\n    'delete',\n];\nvar matchMarkdownLinks = function (message) {\n    var regexMdLinks = /\\[([^[]+)\\](\\(.*\\))/gm;\n    var matches = message.match(regexMdLinks);\n    var singleMatch = /\\[([^[]+)\\]\\((.*)\\)/;\n    var links = matches\n        ? matches.map(function (match) {\n            var i = singleMatch.exec(match);\n            return i && [i[1], i[2]];\n        })\n        : [];\n    return links.flat();\n};\nvar messageCodeBlocks = function (message) {\n    var codeRegex = /```[a-z]*\\n[\\s\\S]*?\\n```|`[a-z]*[\\s\\S]*?`/gm;\n    var matches = message.match(codeRegex);\n    return matches || [];\n};\nexport var truncate = function (input, length, end) {\n    if (end === void 0) { end = '...'; }\n    if (!input || !length)\n        return '';\n    if (input.length > length) {\n        return \"\" + input.substring(0, length - end.length) + end;\n    }\n    return input;\n};\nvar markDownRenderers = {\n    // eslint-disable-next-line react/display-name\n    link: function (props) {\n        var children = props.children, href = props.href;\n        var isEmail = href === null || href === void 0 ? void 0 : href.startsWith('mailto:');\n        var isUrl = href === null || href === void 0 ? void 0 : href.startsWith('http');\n        if (!href || (!isEmail && !isUrl)) {\n            return children;\n        }\n        return (React.createElement(\"a\", { className: \"\" + (isUrl ? 'str-chat__message-url-link' : ''), href: href, rel: 'nofollow noreferrer noopener', target: '_blank' }, children));\n    },\n    span: 'span',\n};\nvar emojiMarkdownPlugin = function () {\n    function replace(match) {\n        return {\n            children: [{ type: 'text', value: match }],\n            className: 'inline-text-emoji',\n            type: 'span',\n        };\n    }\n    var transform = function (markdownAST) {\n        findAndReplace(markdownAST, emojiRegex(), replace);\n        return markdownAST;\n    };\n    return transform;\n};\nvar mentionsMarkdownPlugin = function (mentioned_users) { return function () {\n    var mentioned_usernames = mentioned_users\n        .map(function (user) { return user.name || user.id; })\n        .filter(Boolean)\n        .map(escapeRegExp);\n    function replace(match) {\n        var usernameOrId = match.replace('@', '');\n        var user = mentioned_users.find(function (_a) {\n            var id = _a.id, name = _a.name;\n            return name === usernameOrId || id === usernameOrId;\n        });\n        return {\n            children: [{ type: 'text', value: match }],\n            mentioned_user: user,\n            type: 'mention',\n        };\n    }\n    var transform = function (markdownAST) {\n        if (!mentioned_usernames.length) {\n            return markdownAST;\n        }\n        var mentionedUsersRegex = new RegExp(mentioned_usernames.map(function (username) { return \"@\" + username; }).join('|'), 'g');\n        findAndReplace(markdownAST, mentionedUsersRegex, replace);\n        return markdownAST;\n    };\n    return transform;\n}; };\nvar Mention = function (props) { return React.createElement(\"span\", { className: 'str-chat__message-mention' }, props.children); };\nexport var renderText = function (text, mentioned_users, options) {\n    if (options === void 0) { options = {}; }\n    // take the @ mentions and turn them into markdown?\n    // translate links\n    if (!text)\n        return null;\n    var newText = text;\n    var markdownLinks = matchMarkdownLinks(newText);\n    var codeBlocks = messageCodeBlocks(newText);\n    var detectHttp = /(http(s?):\\/\\/)?(www\\.)?/;\n    // extract all valid links/emails within text and replace it with proper markup\n    uniqBy(linkify.find(newText), 'value').forEach(function (_a) {\n        var href = _a.href, type = _a.type, value = _a.value;\n        var linkIsInBlock = codeBlocks.some(function (block) { return block === null || block === void 0 ? void 0 : block.includes(value); });\n        // check if message is already  markdown\n        var noParsingNeeded = markdownLinks &&\n            markdownLinks.filter(function (text) {\n                var strippedHref = href === null || href === void 0 ? void 0 : href.replace(detectHttp, '');\n                var strippedText = text === null || text === void 0 ? void 0 : text.replace(detectHttp, '');\n                if (!strippedHref || !strippedText)\n                    return false;\n                return strippedHref.includes(strippedText) || strippedText.includes(strippedHref);\n            });\n        if (noParsingNeeded.length > 0 || linkIsInBlock)\n            return;\n        var displayLink = type === 'email' ? value : value.replace(detectHttp, '');\n        newText = newText.replaceAll(value, \"[\" + displayLink + \"](\" + encodeURI(href) + \")\");\n    });\n    var plugins = [emojiMarkdownPlugin];\n    if (mentioned_users === null || mentioned_users === void 0 ? void 0 : mentioned_users.length) {\n        plugins.push(mentionsMarkdownPlugin(mentioned_users));\n    }\n    var renderers = __assign(__assign({ mention: Mention }, markDownRenderers), options.customMarkDownRenderers);\n    return (React.createElement(ReactMarkdown, { allowedTypes: allowedMarkups, escapeHtml: true, plugins: plugins, renderers: renderers, source: newText, transformLinkUri: function (uri) {\n            return uri.startsWith('app://') ? uri : RootReactMarkdown.uriTransformer(uri);\n        }, unwrapDisallowed: true }));\n};\nexport function escapeRegExp(text) {\n    return text.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n}\nfunction S4() {\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n// https://stackoverflow.com/a/6860916/2570866\nexport function generateRandomId() {\n    // prettier-ignore\n    return (S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4());\n}\nexport var smartRender = function (ElementOrComponentOrLiteral, props, fallback) {\n    if (ElementOrComponentOrLiteral === undefined && fallback) {\n        ElementOrComponentOrLiteral = fallback;\n    }\n    if (React.isValidElement(ElementOrComponentOrLiteral)) {\n        // Flow cast through any, to make flow believe it's a React.Element\n        var element = ElementOrComponentOrLiteral;\n        return element;\n    }\n    // Flow cast through any to remove React.Element after previous check\n    var ComponentOrLiteral = ElementOrComponentOrLiteral;\n    if (typeof ComponentOrLiteral === 'string' ||\n        typeof ComponentOrLiteral === 'number' ||\n        typeof ComponentOrLiteral === 'boolean' ||\n        ComponentOrLiteral == null) {\n        return ComponentOrLiteral;\n    }\n    return React.createElement(ComponentOrLiteral, __assign({}, props));\n};\n"]},"metadata":{},"sourceType":"module"}